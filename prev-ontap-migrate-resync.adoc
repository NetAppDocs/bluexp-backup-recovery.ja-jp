---
sidebar: sidebar 
permalink: prev-ontap-migrate-resync.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, BlueXP backup and recovery, Oracle database, Microsoft SQL Server database, SAP HANA database, migrate volumes, SnapMirror to Cloud Resync, ONTAP, NetApp, NetApp ONTAP, NetApp Cloud Volumes ONTAP, NetApp Cloud Volumes Service, FlexVols, FlexGroups 
summary: BlueXP バックアップおよびリカバリの SnapMirror to Cloud Resync 機能は、NetApp 環境でのボリューム移行中のデータ保護と継続性を効率化します。 
---
= BlueXP backup and recoveryでSnapMirrorを使用してボリュームを Cloud Resync に移行する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
BlueXP バックアップおよびリカバリの SnapMirror to Cloud Resync 機能は、NetApp 環境でのボリューム移行中のデータ保護と継続性を効率化します。SnapMirror論理レプリケーション（LRSE）を使用して、オンプレミスのNetApp環境から別の環境、またはCloud Volumes ONTAPやCloud Volumes Serviceなどのクラウドベースのソリューションにボリュームを移行する場合、SnapMirrorからクラウドへの再同期により、既存のクラウドバックアップに影響を与えずに運用できます。

[]
====
*注意* BlueXP backup and recoveryのワークロードを切り替えるには、 link:br-start-switch-ui.html["さまざまなBlueXP backup and recoveryワークロードに切り替える"] 。

====
この機能により、時間とリソースを大量に消費するベースライン再処理が不要になり、移行後もバックアップ処理を継続できます。この機能は、FlexVolとFlexGroupの両方をサポートするワークロードマイグレーションシナリオで役立ちます。ONTAPバージョン9.16.1以降で使用できます。

SnapMirrorからクラウドへの再同期は、環境全体でバックアップの継続性を維持することで運用効率を高め、ハイブリッドクラウドやマルチクラウドのデータ管理の複雑さを軽減します。



== BlueXP backup and recoverySnapMirror to Cloud Resyncの仕組み

機器更改を完了したり、ONTAPクラスタ間でボリュームを移行したりする際には、バックアップが中断されずに継続的に機能することが重要です。BlueXP  のバックアップとリカバリSnapMirrorからクラウドへの再同期は、ボリューム移行後もクラウドバックアップの一貫性を維持することで、これを支援します。

次に例を示します。

Vol1aという名前のオンプレミスボリュームがあるとします。このボリュームには、S1、S2、S3の3つのSnapshotがあります。これらのスナップショットは、リストアポイントのようなものです。vol1は、SnapMirror to Cloud（SM-C）を使用してクラウドオブジェクトストアエンドポイントにすでにバックアップされています。ただし、これまでのところ、オブジェクトストアにバックアップされているのはS1とS2のみです。

次に、vol1を別のONTAPクラスタに移行します。これを行うには、Vol1bという新しいクラウドボリュームに対するSnapMirror論理レプリケーション（LRSE）関係を作成します。これにより、S1、S2、S3の3つのSnapshotすべてがVol1aからVol1bに転送されます。

移行が完了したら、次のセットアップを完了します。

* 元のSM-C関係（Vol1a→オブジェクトストア）が削除されます。
* LRSE関係（Vol1a→Vol1b）も削除されます。
* これでVol1bがアクティブボリュームになります。


この時点で、同じクラウドエンドポイントにVol1bのバックアップを続行します。ただし、フルバックアップを（時間とリソースをかけて）ゼロから開始する代わりに、SnapMirrorからクラウドへの再同期を使用します。

再同期の仕組みは次のとおりです。

* システムは、Vol1aとオブジェクトストアの間に共通のSnapshotがあるかどうかをチェックします。この場合、両方ともS2を持ちます。
* この共有スナップショットのため、システムはS2とS3間の差分変更のみを転送する必要があります。


つまり、ボリューム全体ではなく、S2の送信後に追加された新しいデータのみがオブジェクトストアに送信されます。

このプロセスにより、すでにバックアップされているデータの再送信を回避し、帯域幅を節約し、移行後もバックアップチェーンをスムーズに継続できます。

image:diagram-snapmirror-cloud-resync-migration.png["BlueXP  バックアップとリカバリSnapMirrorからクラウドへの再同期"]



== 手順に関する注意事項

* デスティネーションONTAPクラスタでONTAPバージョン9.16.1以降が実行されている必要があります。
* 古いソースONTAPクラスタは、BlueXP  バックアップおよびリカバリを使用して保護する必要があります。
* BlueXP  のバックアップとリカバリを使用して移行や機器更改を実行することはありません。担当者は、プロフェッショナルサービスチームまたは認定ストレージ管理者に依頼してください。
* NetApp移行チームは、ボリュームの移行を容易にするために、ソースとデスティネーションのONTAPクラスタ間のSnapMirror関係を作成します。
* 機器更改時の移行がSnapMirrorベースの移行に基づいていることを確認
* SVM-Migrate、SVM-DR、またはヘッドスワップ方式を使用した移行後のSnapMirrorからクラウドへの再同期は、現在サポートされていません。




== SnapMirrorを使用したボリュームのクラウド再同期への移行方法

SnapMirrorからクラウドへの再同期を使用してボリュームを移行するには、次の主要な手順を実行します。それぞれについて詳しくは、以下で説明します。

* *移行前のチェックリストに従う*：移行を開始する前に、NetApp機器更改チームが次の前提条件を満たしていることを確認し、データ損失を防ぎ、スムーズな移行プロセスを実現します。
* *移行後のチェックリストに従う*：移行後、NetApp機器更改チームは次の手順を実行して保護を確立し、再同期の準備を行います。
* * SnapMirrorからクラウドへの再同期を実行*：移行後、NetApp機器更改チームがSnapMirrorからクラウドへの再同期処理を実行し、新しく移行したボリュームからクラウドへのバックアップを再開します。


image:diagram-snapmirror-cloud-resync-migration-steps.png["SnapMirrorを使用したボリュームのクラウド再同期への移行手順"]



=== 移行前のチェックリストに従う

NetApp機器更改チームは、移行を開始する前に、データ損失を回避し、スムーズな移行プロセスを実現するために、次の前提条件を満たしていることを確認します。

. マイグレートするすべてのボリュームがBlueXP  のバックアップとリカバリを使用して保護されていることを確認します。
. ボリュームインスタンスUUIDを記録します。移行を開始する前に、すべてのボリュームのインスタンスUUIDを書き留めます。これらの識別子は、あとでマッピングおよび再同期処理を実行する際に非常に重要です。
. SnapMirror関係を削除する前に、各ボリュームの最後のSnapshotを作成して最新の状態を維持します。
. SnapMirrorポリシーを文書化する。各ボリュームの関係に現在適用されているSnapMirrorポリシーを記録します。この設定は、あとでSnapMirrorからクラウドへの再同期プロセスで必要になります。
. オブジェクトストアとのSnapMirror Cloud関係を削除します。
. 新しいONTAPクラスタとの標準のSnapMirror関係を作成して、新しいターゲットONTAPクラスタにボリュームを移行します。




=== 移行後のチェックリストに従う

移行後、NetApp機器更改チームは次の手順を実行して保護を確立し、再同期の準備を行います。

. デスティネーションONTAPクラスタに移行されたすべてのボリュームの新しいボリュームインスタンスUUIDを記録します。
. 古いONTAPクラスタで使用可能であった必要なすべてのSnapMirrorポリシーが、新しいONTAPクラスタで正しく設定されていることを確認します。
. BlueXP  キャンバスで、新しいONTAPクラスタを作業環境として追加します。




=== SnapMirrorからクラウドへの再同期

移行後、NetApp機器更改チームがSnapMirrorからクラウドへの再同期処理を実行し、新たにマイグレートしたボリュームからクラウドのバックアップを再開します。

. BlueXP  キャンバスで、新しいONTAPクラスタを作業環境として追加します。
. BlueXP  の[Backup and Recovery Volumes]ページで、古いソースの作業環境の詳細が表示されていることを確認します。
. BlueXP  の[ボリュームのバックアップとリカバリ]ページで、*[バックアップ設定]*を選択します。
. メニューから*[バックアップの再同期]*を選択します。
. [Resync Working Environment]ページで、次の手順を実行します。
+
.. *新しいソース作業環境*：ボリュームが移動された新しいONTAPクラスタを入力します。
.. *既存のターゲットオブジェクトストア*：古いソース作業環境のバックアップを格納するターゲットオブジェクトストアを選択します。


. [CSVテンプレートのダウンロード]*を選択して、[再同期の詳細] Excelシートをダウンロードします。このシートを使用して、マイグレートするボリュームの詳細を入力します。CSVファイルで、次の詳細を入力します。
+
** ソースクラスタの古いボリュームインスタンスUUID
** デスティネーションクラスタの新しいボリュームインスタンスUUID
** 新しい関係に適用するSnapMirrorポリシーを指定します。


. [Upload Volume Mapping Details]*で[Upload]*を選択し、完成したCSVシートをBlueXP  バックアップ/リカバリUIにアップロードします。
. 再同期処理に必要なプロバイダとネットワークの設定情報を入力します。
. [送信]*を選択して検証プロセスを開始します。
+
BlueXP  のバックアップとリカバリでは、再同期対象として選択した各ボリュームに共通のSnapshotが少なくとも1つ含まれているかどうかが検証されます。これにより、ボリュームでSnapMirrorからクラウドへの再同期処理を実行する準備が整います。

. 新しいソースボリュームの名前や各ボリュームの再同期ステータスなど、検証結果を確認します。
. ボリュームの適性を確認します。ボリュームが再同期の対象になるかどうかがチェックされます。対応していないボリュームは、共通のSnapshotが見つからなかったことを意味します。
+

IMPORTANT: ボリュームがSnapMirrorからクラウドへの再同期処理の対象となるようにするには、移行前のフェーズでSnapMirror関係を削除する前に、各ボリュームの最終Snapshotを作成します。これにより、データの最新の状態が保持されます。

. 再同期処理を開始するには、*[再同期]*を選択します。システムは共通のスナップショットを使用して増分変更のみを転送し、バックアップの継続性を確保します。
. [Job Monitor]ページで、resynプロセスを監視します。

