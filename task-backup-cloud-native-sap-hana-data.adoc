---
sidebar: sidebar 
permalink: task-backup-cloud-native-sap-hana-data.html 
keywords: cloud native, application data, back up, policy, pre-canned policies, scheduled backups, on-demand backups, cloud manager, BlueXP, add hosts, create policy, SAP HANA Database 
summary: SAP HANAデータベースのバックアップをスケジュール設定またはオンデマンドで作成します。 
---
= クラウドネイティブのSAP HANAデータベースをバックアップ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
SAP HANAデータベースのバックアップを作成する前に、SAP HANAデータベースホストを追加し、組み込みのポリシーまたは作成したポリシーを割り当てる必要があります。



== SAP HANAデータベースホストを追加します

ポリシーを割り当ててバックアップを作成するには、SAP HANAデータベースホストを手動で追加する必要があります。SAP HANAデータベースホストの自動検出はサポートされていません。

* 必要なもの *

* 作業環境を追加し、コネクタを作成しておく必要があります。
* コネクタが作業環境に接続されていることを確認します
* BlueXPユーザーに「アカウント管理者」の役割があることを確認します。
* SnapCenter Plug-in for SAP HANAを導入しておく必要があります。 link:task-deploy-snapcenter-plugin-for-sap-hana.html["詳細はこちら。"]
* SAP HANAデータベースホストを追加する場合は、HDBユーザストアキーを追加する必要があります。HDBセキュアユーザストアキーは、SAP HANAデータベースホストの接続情報をクライアントにセキュアに格納し、HDBSQLクライアントでセキュアなユーザストアキーを使用してSAP HANAデータベースホストに接続するために使用されます。
* HANA System Replication（HSR；システムレプリケーション）の場合、HANAシステムを保護するには、プライマリとセカンダリの両方のHANAシステムを手動で登録する必要があります。


* 手順 *

. BlueXP* UIで、[*保護*>*バックアップとリカバリ*>*アプリケーション*]をクリックします。
. [*アプリケーションの検出*]をクリックします。
. Cloud Native *>* SAP HANA *を選択し、* Next *をクリックします。
. [*アプリケーション*]ページで、[*システムの追加*]をクリックします。
. [システムの詳細*]ページで、次の操作を実行します。
+
.. システムタイプとしてMulti-tenantデータベースコンテナまたはSingle Containerを選択します。
.. SAP HANAシステムの名前を入力します。
.. SAP HANA システムの SID を指定します。
.. （オプション）HDBSQL OSユーザを指定します。
.. プラグインホストを選択します。（オプション）ホストが追加されていない場合、または複数のホストを追加する場合は、*プラグインホストの追加*をクリックします。
.. HANAシステムがHANAシステムレプリケーションで構成されている場合は、* HANA System Replication（HSR）System *を有効にします。
.. ユーザーストアキーの詳細を追加するには、[*HDB Secure User Store Keys*]テキストボックスをクリックします。
+
キー名、システムの詳細、ユーザー名、パスワードを指定し、*キーの追加*をクリックします。

+
ユーザストアキーは削除または変更できます。



. 「 * 次へ * 」をクリックします。
. [ストレージ容量*]ページで、[*ストレージの追加]をクリックして、次の操作を実行します。
+
.. 作業環境を選択し、ネットアップアカウントを指定します。
+
新しい作業環境を追加するには、[* Canvas *（キャンバス*）]ページに移動します

.. 必要なボリュームを選択します。
.. [ ストレージの追加 ] をクリックします。


. すべての詳細を確認し、*システムの追加*をクリックします。



NOTE: 特定のホストを表示するフィルタが機能しない。フィルタでホスト名を指定すると、すべてのホストが表示されます

REST APIを使用してSAP HANAシステムを変更および削除できます。HANAシステムを削除する前に、関連付けられているバックアップをすべて削除し、保護を解除してください。



== 非データボリュームを追加します

マルチテナントデータベースコンテナまたは単一コンテナタイプのSAP HANAシステムを追加したら、HANAシステムの非データボリュームを追加できます。

* 手順 *

. BlueXP* UIで、[*保護*>*バックアップとリカバリ*>*アプリケーション*]をクリックします。
. [*アプリケーションの検出*]をクリックします。
. Cloud Native *>* SAP HANA *を選択し、* Next *をクリックします。
. [*アプリケーション*]ページで、をクリックします image:icon-action.png["アイコンをクリックして操作を選択します"] 非データボリュームを追加するシステムに対応し、*システム管理*>*非データボリューム*を選択します。




== グローバルな非データボリュームを追加します

マルチテナントデータベースコンテナまたは単一コンテナタイプのSAP HANAシステムを追加したら、HANAシステムのグローバル非データボリュームを追加できます。

* 手順 *

. BlueXP* UIで、[*保護*>*バックアップとリカバリ*>*アプリケーション*]をクリックします。
. [*アプリケーションの検出*]をクリックします。
. Cloud Native *>* SAP HANA *を選択し、* Next *をクリックします。
. [*アプリケーション*]ページで、[*システムの追加*]をクリックします。
. [システムの詳細*]ページで、次の操作を実行します。
+
.. System Type（システムタイプ）ドロップダウンから、* Global Non-Data Volume（グローバル非データボリューム）*を選択します。
.. SAP HANAシステムの名前を入力します。
.. SAP HANAシステムの関連付けられたSIDを指定します。
.. プラグインホストを選択します
+
（オプション）複数のホストを追加するには、*プラグインホストの追加*をクリックし、ホスト名とポートを指定して、*ホストの追加*をクリックします。

.. 「 * 次へ * 」をクリックします。
.. すべての詳細を確認し、*システムの追加*をクリックします。






== プリスクリプトとポストスクリプト

ポリシーの作成時にプリスクリプト、ポストスクリプト、および終了スクリプトを指定できます。これらのスクリプトは、バックアップの作成時にHANAホストで実行されます。

サポートされているスクリプトの形式は、.sh、Pythonスクリプト、perlスクリプトなどです。

プリスクリプトとポストスクリプトは、ホスト管理者がに登録する必要があります `/opt/NetApp/snapcenter/scc/etc/allowed_commands.config file`

`[root@scspa2622265001 etc]# cat allowed_commands.config
command: mount
command: umount
command: /mnt/scripts/pre_script.sh
command: /mnt/scripts/post_script.sh`



== 環境変数

リストアワークフローでは、プリスクリプトとポストスクリプトの一部として次の環境変数を使用できます。

|===
| 環境変数 | 説明 


 a| 
SID
 a| 
リストア用に選択したHANAデータベースのシステムID



 a| 
BackupNameの略
 a| 
リストア処理用に選択されたバックアップ名



 a| 
UserStoreKeyNames
 a| 
HANAデータベース用にユーザストアキーを設定しました



 a| 
OSDBUser
 a| 
HANAデータベース用にOSDBUserを設定



 a| 
実行します
 a| 
スケジュールされたバックアップの場合のみ



 a| 
schedule_type
 a| 
スケジュールされたバックアップの場合のみ

|===


== SAP HANAデータベースを保護するためのポリシーを作成します

組み込みポリシーを使用または編集しない場合は、ポリシーを作成できます。

. [*アプリケーション*]ページの[設定]ドロップダウンリストから、[*ポリシー*]を選択します。
. ［*ポリシーの作成*］をクリックします。
. ポリシー名を指定します。
. （オプション）Snapshotコピー名の形式を編集します。
. ポリシータイプを選択します。
. スケジュールと保持の詳細を指定します。
. （任意）スクリプトを指定します。
. [ 作成（ Create ） ] をクリックします。




== SAP HANAデータベースのバックアップを作成します

組み込みポリシーを割り当てるか、ポリシーを作成してデータベースに割り当てることができます。ポリシーを割り当てると、ポリシーで定義されたスケジュールに従ってバックアップが作成されます。

* このタスクについて *

HANA System Replication（HSR；システムレプリケーション）の場合、スケジュールされたバックアップジョブはプライマリHANAシステムに対してのみトリガーされ、システムがセカンダリHANAシステムにフェイルオーバーすると、既存のスケジュールが現在のプライマリHANAシステムでバックアップをトリガーします。両方のHANAシステムにポリシーが割り当てられていない場合、フェイルオーバー後にスケジュールは失敗します。

HSRシステムに異なるポリシーが割り当てられている場合、システムとセカンダリHANAシステムのバックアップの両方に対してスケジュールされたバックアップがトリガーされます。

* 手順 *

. [アプリケーション]ページで、データベースがポリシーを使用して保護されていない場合は、[*ポリシーの割り当て*]をクリックします。
+
データベースが1つ以上のポリシーを使用して保護されている場合は、をクリックして複数のポリシーを割り当てることができます image:icon-action.png["アイコンをクリックして操作を選択します"] >*ポリシーの割り当て*。

. ポリシーを選択し、* assign *をクリックします。
+
バックアップは、ポリシーで定義されたスケジュールに従って作成されます。

+

NOTE: サービスアカウント（_SnapCenter -account-<account_id>_）は、スケジュールされたバックアップ処理の実行に使用されます。





== SAP HANAデータベースのオンデマンドバックアップを作成する

ポリシーを割り当てたら、アプリケーションのオンデマンドバックアップを作成できます。

* 手順 *

. [*アプリケーション*]ページで、をクリックします image:icon-action.png["アイコンをクリックして操作を選択します"] アプリケーションに対応して、*オンデマンドバックアップ*をクリックします。
. オンデマンドバックアップタイプを選択します。
. ポリシーベースのバックアップの場合、ポリシーと保持階層を選択し、*バックアップの作成*をクリックします。
. Snapshotコピーベースを1回選択するか、ファイルベースを選択して、次の手順を実行します。
+
.. 保持値を選択し、バックアップ名を指定します。
.. （任意）スクリプトおよびスクリプトのパスを指定します。
.. [ バックアップの作成 *] をクリックします。



