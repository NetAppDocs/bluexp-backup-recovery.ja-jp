---
sidebar: sidebar 
permalink: concept-ontap-backup-to-cloud.html 
keywords: backing up, restoring, back up, backup, restore, cloud volumes ontap, aws, azure, s3, blob, google cloud, storagegrid, back up volumes, cloud backup, restore volumes, billing, cost, on-premises ontap, onprem 
summary: Cloud Backup は、 ONTAP クラスタデータを保護し、長期アーカイブするためのバックアップおよびリストア機能を提供します。バックアップは、ほぼ期間のリカバリやクローニングに使用されるボリューム Snapshot コピーとは関係なく、パブリックまたはプライベートのクラウドアカウントのオブジェクトストアに自動的に生成されて格納されます。 
---
= Cloud Backup を使用して ONTAP クラスタのデータを保護します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Cloud Backup は、 ONTAP クラスタデータを保護し、長期アーカイブするためのバックアップおよびリストア機能を提供します。バックアップは、ほぼ期間のリカバリやクローニングに使用されるボリューム Snapshot コピーとは関係なく、パブリックまたはプライベートのクラウドアカウントのオブジェクトストアに自動的に生成されて格納されます。

必要に応じて、バックアップから同じ作業環境または別の作業環境に、 _volume__ 全体または 1 つ以上の _files_ をリストアできます。



== の機能

バックアップ機能：

* データボリュームの独立したコピーを低コストのオブジェクトストレージにバックアップできます。
* クラスタ内のすべてのボリュームに単一のバックアップポリシーを適用するか、または一意のリカバリポイント目標が設定されたボリュームに異なるバックアップポリシーを割り当てます。
* 古いバックアップファイルをアーカイブストレージに階層化してコストを削減（ ONTAP 9.10.1 以降では AWS と Azure でサポート）
* クラウドからクラウドへ、オンプレミスシステムからパブリッククラウドやプライベートクラウドへバックアップできます。
* Cloud Volumes ONTAP システムの場合、バックアップは別のサブスクリプションやアカウントに配置することも、別のリージョンに配置することもできます。
* バックアップデータは、転送中の AES-256 ビット暗号化と TLS 1.2 HTTPS 接続によって保護されます。
* クラウドプロバイダのデフォルトの暗号化キーを使用する代わりに、お客様が管理する独自のキーを使用してデータを暗号化します。
* 単一ボリュームで最大 4 、 000 個のバックアップがサポートされます。


リストア機能：

* 特定の時点からデータをリストアします。
* ボリュームまたは個々のファイルをソースシステムまたは別のシステムにリストアする。
* 別のサブスクリプション / アカウントを使用して、または別のリージョンにある作業環境にデータをリストアする。
* 元の ACL を維持したまま、指定した場所にデータを直接配置して、ブロックレベルでデータをリストアします。
* 単一ファイルのリストア用に個々のファイルを選択できる、参照可能で検索可能なファイルカタログです。




== サポート対象の ONTAP 作業環境およびオブジェクトストレージプロバイダ

Cloud Backup を使用すると、以下の作業環境から次のパブリックおよびプライベートクラウドプロバイダのオブジェクトストレージに ONTAP ボリュームをバックアップできます。

[cols="45,45"]
|===
| ソースの作業環境 | バックアップファイルの保存先 


| AWS の Cloud Volumes ONTAP | Amazon S3 


| Azure の Cloud Volumes ONTAP | Azure Blob の略 


| Google の Cloud Volumes ONTAP | Google クラウドストレージ 


| オンプレミスの ONTAP システム | Amazon S3 Azure Blob Google Cloud Storage NetApp StorageGRID 
|===
ONTAP バックアップファイルから次の作業環境にボリュームまたは個々のファイルをリストアできます。

[cols="25,33,37"]
|===
| バックアップファイル 2+| デスティネーションの作業環境 


| * 場所 * | * ボリュームの復元 * | * ファイルの復元 * 


| Amazon S3 | オンプレミスの AWS ONTAP システムに Cloud Volumes ONTAP が導入されている | オンプレミスの AWS ONTAP システムに Cloud Volumes ONTAP が導入されている 


| Azure Blob の略 | オンプレミスの Azure ONTAP システムに Cloud Volumes ONTAP を導入 | オンプレミスの Azure ONTAP システムに Cloud Volumes ONTAP を導入 


| Google クラウドストレージ | Google オンプレミス ONTAP システムの Cloud Volumes ONTAP | Google オンプレミス ONTAP システムの Cloud Volumes ONTAP 


| NetApp StorageGRID | オンプレミスの ONTAP システム |  
|===
「オンプレミス ONTAP システム」とは、 FAS 、 AFF 、 ONTAP Select の各システムを指します。



== コスト

ONTAP システムでクラウドバックアップを使用する場合、リソース料金とサービス料金の 2 種類のコストが発生します。

* リソース料金 *

リソースの料金は、オブジェクトストレージの容量とクラウドでの仮想マシン / インスタンスの実行についてクラウドプロバイダに支払います。

* バックアップでは、クラウドプロバイダにオブジェクトストレージのコストを支払います。
+
クラウドバックアップではソースボリュームの Storage Efficiency が保持されるため、クラウドプロバイダ側で、 data_after_ONTAP 効率化のコストを支払います（重複排除と圧縮が適用されたあとのデータ量が少ないほど）。

* Browse & Restore を使用してファイルをリストアする場合は、リストアインスタンスが実行されている場合にのみ、コンピューティングコストについてクラウドプロバイダにお支払いください。
+
インスタンスは、バックアップファイルを参照してリストアする個々のファイルを探すときにのみ実行されます。コストを節約するために使用していない場合、インスタンスはオフになります。

+
** AWS では、 Restore インスタンスはで実行されます https://aws.amazon.com/ec2/instance-types/m5/["m5n.xlarge インスタンス"^] CPU × 4 、 16GB のメモリ、および EBS 専用インスタンスストレージオペレーティングシステムイメージは Amazon Linux 2 です。
+
m5n.xlarge インスタンスを使用できない領域では、代わりに m5.xlarge インスタンスで Restore が実行されます。

** Azure では、 Restore 仮想マシンがで実行されます https://docs.microsoft.com/en-us/azure/virtual-machines/dv3-dsv3-series#dsv3-series["Standard_D4s_v3 VM"^] CPU × 4 、メモリ × 16 、 32GiB ディスク × 1 の場合。オペレーティングシステムイメージは CentOS 7.5 ）です。
+
インスタンスの名前は _Cloud-Restore-Instance_with Your Account ID Concatenated です。例： _Cloud-Restore-Instance-MyAccount_ 。



* Browse & Restore を使用してボリュームをリストアする場合は、個別のインスタンスや仮想マシンが必要ないため、コストは発生しません。
* 検索とリストアを使用したボリュームまたはファイルのリストアでは、特定のリソースがクラウドプロバイダによってプロビジョニングされ、検索要求でスキャンされるデータ量には1TiBあたりのコストが関連付けられます。
+
** AWSでは、 https://aws.amazon.com/athena/faqs/["Amazon Athena"^] および https://aws.amazon.com/glue/faqs/["AWS 接着剤"^] リソースは新しいS3バケットに導入される。
** Googleでは、新しいバケットが導入され、が展開されます https://cloud.google.com/bigquery["Google Cloud BigQueryサービス"^] アカウント/プロジェクトレベルでプロビジョニングされます。


* （ONTAP 9.10.1以降を使用するAWSでサポートされる）アーカイブストレージに移動されたバックアップファイルからボリュームデータをリストアする必要がある場合は、GiBあたりの読み出し料金とクラウドプロバイダからの要求ごとの料金が別途かかります。


* サービス料金 *

サービス料金はネットアップに支払われ、バックアップの作成時とリストア時のボリューム、またはファイルに対する費用の両方が含まれます。保護するデータの料金は、オブジェクトストレージにバックアップされる ONTAP のソースの使用済み論理容量（ _Before_ONTAP 効率化）で計算されます。この容量はフロントエンドテラバイト（ FETB ）とも呼ばれます。

バックアップサービスの料金を支払う方法は 3 通りあります。1 つ目は、クラウドプロバイダを利用して月額料金を支払う方法です。もう 1 つの選択肢は、年間契約を取得することです。これは AWS でのみ利用できます。3 つ目のオプションは、ネットアップからライセンスを直接購入することです。を参照してください <<Licensing,ライセンス>> 詳細については、を参照してください



== ライセンス

Cloud Backupには3つのライセンスオプションがあります。従量課金制（PAYGO）サブスクリプションと、AWS Marketplaceでの年間契約、お客様所有のライセンスの使用（BYOL）です。PAYGOサブスクリプションを取得した場合は、30日間の無償トライアルを利用できます。



=== 従量課金制のサブスクリプション

Cloud Backup は従量課金制モデルで、使用量に応じたライセンスを提供します。クラウドプロバイダの市場に登録した後は、バックアップされたデータに対して GiB 単位で料金が発生します。つまり、前払いによる支払いが発生しません。クラウドプロバイダから月額料金で請求されます。

link:task-licensing-cloud-backup.html#use-a-cloud-backup-paygo-subscription["従量課金制サブスクリプションの設定方法について説明します"]。



=== 年間契約（ AWS のみ）

AWS Marketplace では、 12 カ月、 24 カ月、または 36 カ月間の契約が 2 件提供されます。

* Cloud Volumes ONTAP データとオンプレミスの ONTAP データをバックアップできる「クラウドバックアップ」プラン。
* Cloud Volumes ONTAP とクラウドバックアップをバンドルできる「 CVO Professional 」プラン。これには、このライセンスに基づいて Cloud Volumes ONTAP ボリュームのバックアップが無制限になることも含まれます（バックアップ容量はライセンスにはカウントされません）。


link:task-licensing-cloud-backup.html#subscribe-to-yearly-contracts-through-aws["毎年の AWS 契約を設定する方法をご確認ください"]。



=== お客様所有のライセンスを使用

BYOL は期間ベース（ 12 カ月、 24 カ月、 36 カ月）の _ 容量ベースであり、 1TiB 単位で提供されます。ネットアップに料金を支払って、 1 年分のサービスを使用し、最大容量を指定した場合は「 10TiB 」とします。

サービスを有効にするために、 Cloud Manager のデジタルウォレットのページに入力したシリアル番号が表示されます。いずれかの制限に達すると、ライセンスを更新する必要があります。Backup BYOL ライセンス環境 では、に関連付けられているすべてのソースシステムがライセンスされます https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-netapp-accounts.html["Cloud Manager アカウント"^]。

link:task-licensing-cloud-backup.html#use-a-cloud-backup-byol-license["BYOL ライセンスの管理方法について説明します"]。



== Cloud Backup の仕組み

Cloud Volumes ONTAP またはオンプレミスの ONTAP システムでクラウドバックアップを有効にすると、サービスはデータのフルバックアップを実行します。ボリューム Snapshot はバックアップイメージに含まれません。初期バックアップ後は、追加のバックアップはすべて差分になります。つまり、変更されたブロックと新しいブロックのみがバックアップされます。これにより、ネットワークトラフィックを最小限に抑えることができます。

ほとんどの場合、すべてのバックアップ処理に Cloud Manager UI を使用します。ただし、 ONTAP 9.9.1 以降では、 ONTAP System Manager を使用して、オンプレミスの ONTAP クラスタのボリュームバックアップ処理を開始できます。 https://docs.netapp.com/us-en/ontap/task_cloud_backup_data_using_cbs.html["Cloud Backup を使用してボリュームをクラウドにバックアップする方法については、 System Manager の説明を参照してください。"^]


CAUTION: クラウドプロバイダ環境からバックアップファイルの管理や変更を直接行うと、ファイルが破損してサポートされない構成になる可能性があります。

次の図は、各コンポーネント間の関係を示しています。

image:diagram_cloud_backup_general.png["Cloud Backup が、ソースシステム上のボリュームおよびバックアップファイルが配置されているデスティネーションオブジェクトストレージと通信する仕組みを示す図。"]



=== バックアップの保管場所バックアップノバショ

バックアップコピーは、 Cloud Manager がクラウドアカウントで作成するオブジェクトストアに格納されます。クラスタ / 作業環境ごとに 1 つのオブジェクトストアがあり、 Cloud Manager は「 NetApp-backup-clusteruuid 」のようにオブジェクトストアに名前を付けます。このオブジェクトストアは削除しないでください。

* AWS では、 Cloud Manager によってが有効になります https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html["Amazon S3 ブロックのパブリックアクセス機能"^] を S3 バケットに配置します。
* Azure では、 Cloud Manager は BLOB コンテナのストレージアカウントを持つ新規または既存のリソースグループを使用します。クラウドマネージャ https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent["BLOB データへのパブリックアクセスをブロックします"] デフォルトでは
* GCP では、 Cloud Manager は Google Cloud Storage バケット用のストレージアカウントを持つ新規または既存のプロジェクトを使用します。
* StorageGRID では、 Cloud Manager はオブジェクトストアバケットに既存のストレージアカウントを使用します。


あとでクラスタのデスティネーションオブジェクトストアを変更する場合は、が必要になります link:task-manage-backups-ontap.html#unregistering-cloud-backup-for-a-working-environment["作業環境の Cloud Backup の登録を解除します"^]をクリックし、新しいクラウドプロバイダ情報を使用して Cloud Backup を有効にします。



=== サポートされるストレージクラスまたはアクセス階層

* AWS では、バックアップは _Standard_storage クラスから開始し、 30 日後に _Standard-Infrequent Access_storage クラスに移行します。
+
クラスタが ONTAP 9.10.1 以降を使用している場合は、古いバックアップを S3 Glacier Deep Archive_storage のいずれかに階層化して、特定の日数が経過したらコストをさらに最適化することができます。 link:reference-aws-backup-tiers.html["AWS アーカイブストレージの詳細は、こちらをご覧ください"^]。

* Azure では、バックアップは _COOL アクセス層に関連付けられます。
+
クラスタが ONTAP 9.10.1 以降を使用している場合は、特定の日数が経過した古いバックアップを Azure Archive_storage に階層化して、コストをさらに最適化することができます。 link:reference-azure-backup-tiers.html["Azure アーカイブストレージの詳細については、こちらをご覧ください"^]。

* GCP では、バックアップはデフォルトで _Standard_storage クラスに関連付けられています。
+
また、 lower cost_Nearline_storage クラスまたは _Coldline_or_Archive_storage クラスを使用することもできます。Google のトピックを参照してください link:https://cloud.google.com/storage/docs/storage-classes["ストレージクラス"^] ストレージクラスの変更については、を参照してください。

* StorageGRID では、バックアップは _Standard_storage クラスに関連付けられます。




=== クラスタごとにカスタマイズ可能なバックアップスケジュールと保持設定

作業環境で Cloud Backup を有効にすると、最初に選択したすべてのボリュームが、定義したデフォルトのバックアップポリシーを使用してバックアップされます。Recovery Point Objective （ RPO ；目標復旧時点）が異なるボリュームに対して異なるバックアップポリシーを割り当てる場合は、そのクラスタに追加のポリシーを作成し、そのポリシーを他のボリュームに割り当てることができます。

すべてのボリュームについて、毎時、毎日、毎週、および毎月のバックアップを組み合わせて選択できます。また、システム定義のポリシーの中から、 3 カ月、 1 年、 7 年のバックアップと保持を提供するポリシーを選択することもできます。ポリシーは次のとおりです。

[cols="35,16,16,16,26"]
|===
| バックアップポリシー名 3+| 間隔ごとのバックアップ ... | 最大バックアップ 


|  | * 毎日 * | * 毎週 * | * 毎月 * |  


| Netapp3MonthsRetention | 30 | 13 | 3. | 46 


| Netapp1YearRetention | 30 | 13 | 12. | 55 


| ネッパ7YearsRetention | 30 | 53 | 84 | 167 
|===
ONTAP System Manager または ONTAP CLI を使用してクラスタに作成したバックアップ保護ポリシーも選択内容として表示されます。

カテゴリまたは間隔のバックアップの最大数に達すると、古いバックアップは削除されるため、常に最新のバックアップが保持されます。

できることに注意してください link:task-manage-backups-ontap.html#creating-a-manual-volume-backup-at-any-time["ボリュームのオンデマンドバックアップを作成する"] スケジュールバックアップから作成されたバックアップファイルに加え、いつでも Backup Dashboard からアクセスできます。


TIP: データ保護ボリュームのバックアップの保持期間は、ソースの SnapMirror 関係の定義と同じです。API を使用して必要に応じてこの値を変更できます。



== FabricPool 階層化ポリシーに関する考慮事項

バックアップするボリュームが FabricPool アグリゲートに配置され、「 none 」以外のポリシーが割り当てられている場合に注意する必要がある点があります。

* FabricPool 階層化ボリュームの最初のバックアップでは、（オブジェクトストアからの）ローカルおよびすべての階層化データを読み取る必要があります。バックアップ処理では、オブジェクトストレージに階層化されたコールドデータは「再加熱」されません。
+
この処理を実行すると、クラウドプロバイダからデータを読み取るコストが 1 回だけ増加する可能性があります。

+
** 2 回目以降のバックアップは増分バックアップとなるため、影響はありません。
** ボリュームの作成時に階層化ポリシーが割り当てられていた場合、この問題は表示されません。


* ボリュームに「 all 」階層化ポリシーを割り当てる前に、バックアップの影響を考慮してください。データはすぐに階層化されるため、 Cloud Backup はローカル階層からではなくクラウド階層からデータを読み取ります。バックアップの同時処理は、クラウドオブジェクトストレージへのネットワークリンクを共有するため、ネットワークリソースが最大限まで使用されなくなった場合にパフォーマンスが低下する可能性があります。この場合、複数のネットワークインターフェイス（ LIF ）をプロアクティブに設定して、この種類のネットワークの飽和を軽減することができます。




== サポートされるボリューム

Cloud Backup では、 FlexVol の読み書き可能ボリュームと SnapMirror データ保護（ DP ）のデスティネーションボリュームがサポートされます。

FlexGroup ボリュームと SnapLock ボリュームは現在サポートされていません。



== 制限

* 古いバックアップファイルをアーカイブストレージに階層化できるためには、クラスタで ONTAP 9.10.1 以降（現在は AWS と Azure でサポート）が実行されている必要があります。アーカイブストレージにあるバックアップファイルからボリュームをリストアするには、デスティネーションクラスタで ONTAP 9.10.1 以降が実行されている必要もあります。
* ポリシーにボリュームが割り当てられていない場合にバックアップポリシーを作成または編集するときは、バックアップの保持数を 1018 以下にする必要があります。回避策 では、ポリシーを作成するバックアップの数を減らすことができます。その後、ポリシーを編集して、ポリシーにボリュームを割り当てたあとで最大 4 、 000 個のバックアップを作成できます。
* データ保護（ DP ）ボリュームをバックアップする場合、次の SnapMirror ラベルが設定されている関係はクラウドにバックアップされません。
+
** APP_Consistent
** all_source_snapshot


* SVM-DR ボリュームバックアップは、次の制限事項でサポートされます。
+
** バックアップは ONTAP セカンダリからのみサポートされます。
** ボリュームに適用される Snapshot ポリシーは、日単位、週単位、月単位など、クラウドバックアップで認識されるポリシーのいずれかである必要があります。デフォルトの「 sm_created 」ポリシー（すべての Snapshot をミラー * する場合に使用） が認識されず、バックアップ可能なボリュームのリストに DP ボリュームが表示されない。


* [ 今すぐバックアップ ] ボタンを使用したアドホック・ボリューム・バックアップは ' データ保護ボリュームではサポートされていません
* SM-BC 設定はサポートされません。
* MetroCluster （ MCC ）バックアップは、 ONTAP セカンダリからのみサポートされます。 MCC>SnapMirror > ONTAP > Cloud Backup > オブジェクトストレージ。
* ONTAP では、単一のボリュームから複数のオブジェクトストアへの SnapMirror 関係のファンアウトはサポートされていません。そのため、この構成は Cloud Backup ではサポートされていません。
* オブジェクトストアでの Worm/Compliance モードはサポートされません。




=== 単一ファイルのリストアに関する制限事項

* 単一ファイルのリストアでは、一度に最大 100 個のファイルをリストアできます。現在、フォルダ / ディレクトリのリストアはサポートされていません。
* リストアするファイルは、デスティネーションボリュームの言語と同じ言語を使用している必要があります。言語が異なる場合は、エラーメッセージが表示されます。
* 異なるサブネットにある異なる Cloud Manager で同じアカウントを使用する場合、ファイルレベルのリストアはサポートされません。
* バックアップファイルがアーカイブストレージにある場合は、個々のファイルをリストアできません。

