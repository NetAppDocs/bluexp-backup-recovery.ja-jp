---
sidebar: sidebar 
permalink: task-backup-to-gcp.html 
keywords: backing up, back up, backup, backup cloud volumes ontap, back up cloud volumes ontap, cloud volumes ontap, gcp, google cloud, back up volumes, cloud backup 
summary: Cloud Volumes ONTAP システムからGoogle Cloudストレージへのボリュームデータのバックアップを開始するには、いくつかの手順を実行します。 
---
= Cloud Volumes ONTAP データの Google Cloud Storage へのバックアップ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Cloud Volumes ONTAP システムからGoogle Cloud Storageへのボリュームデータのバックアップを開始するには、いくつかの手順を実行します。



== クイックスタート

これらの手順を実行してすぐに作業を開始するか、残りのセクションまでスクロールして詳細を確認してください。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["1つ"] 構成がサポートされていることを確認します
[role="quick-margin-list"]
* GCPでCloud Volumes ONTAP 9.7P5以降を実行している（ONTAP 9.8P13以降を推奨）。
* バックアップを保存するストレージスペースの有効な GCP サブスクリプションがあります。
* Google Cloud Project に、事前定義された Storage Admin ロールを持つサービスアカウントがあります。
* に登録しておきます https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project&rif_reserved["BlueXP Marketplaceバックアップ製品"^]またはを購入したことが必要です link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license["アクティブ化されます"^] ネットアップが提供するBlueXPバックアップ/リカバリのBYOLライセンス
* Google Cloudにコネクタがインストールされている必要があります。


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["2 つ"] 新規または既存のシステムでBlueXPのバックアップとリカバリを有効にします
[role="quick-margin-list"]
* 新しいシステム：新しい作業環境ウィザードを完了したら、BlueXPのバックアップとリカバリを有効にできます。
* 既存のシステム：作業環境を選択し、右パネルのバックアップ/リカバリサービスの横にある*Enable*をクリックして、セットアップ・ウィザードに従います。
+
image:screenshot_backup_cvo_enable.png["作業環境を選択すると表示されるBlueXPのバックアップとリカバリの[有効化]ボタンのスクリーンショット。"]



.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["3つ"] プロバイダの詳細を入力します
[role="quick-margin-para"]
バックアップ用にGoogle Cloud Storageバケットを作成するGoogle Cloud Projectとリージョンを選択します。また、Googleが管理するデフォルトの暗号化キーを使用する代わりに、お客様が管理する独自のキーを選択してデータを暗号化することもできます。

[role="quick-margin-para"]
image:screenshot_backup_provider_settings_gcp.png["GCP にインストールされた Cloud Volumes ONTAP システムから Google Cloud Storage バケットにボリュームをバックアップする際のクラウドプロバイダの詳細を示すスクリーンショット。"]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-4.png["4."] デフォルトのバックアップポリシーを定義
[role="quick-margin-para"]
デフォルトポリシーでは、毎日ボリュームがバックアップされ、各ボリュームの最新の 30 個のバックアップコピーが保持されます。毎時、毎日、毎週、毎月、または毎年のバックアップに変更します。 または、オプションを追加するシステム定義のポリシーを1つ選択します。保持するバックアップコピーの数を変更することもできます。

[role="quick-margin-para"]
バックアップはデフォルトでStandardストレージに格納されます。クラスタでONTAP 9.12.1以降を使用している場合は、特定の日数を経過したバックアップをアーカイブストレージに階層化して、コストをさらに最適化することができます。 link:concept-cloud-backup-policies.html["使用可能なBlueXPのバックアップとリカバリポリシーの設定の詳細については、こちらをご覧ください"^]。

[role="quick-margin-para"]
image:screenshot_backup_policy_gcp.png["BlueXPのバックアップとリカバリの設定を示すスクリーンショット。この機能を有効または無効にして、バックアップの保持期間を選択できます。"]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-5.png["5 つ"] バックアップするボリュームを選択します
[role="quick-margin-para"]
Select Volumes （ボリュームの選択）ページで、デフォルトのバックアップポリシーを使用してバックアップするボリュームを特定します。特定のボリュームに異なるバックアップポリシーを割り当てる場合は、あとから追加のポリシーを作成してボリュームに適用できます。



== 要件

Google Cloud ストレージへのボリュームのバックアップを開始する前に、次の要件を参照して、サポートされる構成になっていることを確認してください。

次の図は、各コンポーネントとその間の準備に必要な接続を示しています。

image:diagram_cloud_backup_cvo_google.png["BlueXPのバックアップおよびリカバリが、ソースシステム上のボリュームおよびバックアップファイルが配置されているデスティネーションストレージとどのように通信するかを示す図。"]

サポートされている ONTAP のバージョン:: ONTAP 9.7P5以降を使用することを推奨します。ONTAP 9.8P13以降を使用することを推奨します。
ライセンス要件:: BlueXPのバックアップとリカバリのPAYGOライセンスの場合は、でBlueXPのサブスクリプションを購入します https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project&rif_reserved["GCP Marketplace"^] は、BlueXPのバックアップとリカバリを有効にする前に必要です。BlueXPのバックアップとリカバリの課金は、このサブスクリプションを通じて行われます。 https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-deploying-gcp.html["作業環境ウィザードの詳細  資格情報ページから購読できます"^]。
+
--
BlueXPのバックアップとリカバリのBYOLライセンスの場合は、ライセンスの期間と容量にわたってサービスを使用できるネットアップのシリアル番号が必要です。 link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license["BYOL ライセンスの管理方法について説明します"^]。

また、バックアップを保存するストレージスペースの Google サブスクリプションが必要です。

--
サポートされる GCP リージョン:: BlueXPのバックアップとリカバリは、すべてのGCPリージョンでサポートされます https://cloud.netapp.com/cloud-volumes-global-regions["Cloud Volumes ONTAP がサポートされている場合"^]。
GCP サービスアカウント:: 事前定義された Storage Admin ロールを持つサービスアカウントが Google Cloud Project に必要です。 https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-creating-gcp-service-account.html["サービスアカウントの作成方法について説明します"^]。
コネクタの要件:: コネクタは、インターネットにアクセスできるGoogleリージョンにインストールする必要があります。
+
--
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-connectors.html["コネクタについて説明します"^]
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-quick-start-connector-google.html["Google Cloudにコネクタをデプロイします"^]


--
コネクタの権限を確認または追加します:: BlueXPのバックアップとリカバリの「Search & Restore」機能を使用するには、コネクタがGoogle Cloud BigQueryサービスにアクセスできるように、コネクタのロールに特定の権限が必要です。以下の権限を確認し、ポリシーを変更する必要がある場合は手順に従います。
+
--
. インチ https://console.cloud.google.com["Cloud Console の略"^]をクリックし、 * Roles * ページに移動します。
. ページ上部のドロップダウンリストを使用して、編集するロールを含むプロジェクトまたは組織を選択します。
. カスタムロールをクリックします。
. 役割の権限を更新するには、 * 役割の編集 * をクリックします。
. [ 権限の追加 *] をクリックして、次の新しい権限を役割に追加します。
+
[source, json]
----
bigquery.jobs.get
bigquery.jobs.list
bigquery.jobs.listAll
bigquery.datasets.create
bigquery.datasets.get
bigquery.jobs.create
bigquery.tables.get
bigquery.tables.getData
bigquery.tables.list
bigquery.tables.create
----
. [ 更新（ Update ） ] をクリックして、編集したロールを保存する。


--
顧客が管理する暗号化キー（CMEK）の使用に必要な情報:: Googleが管理するデフォルトの暗号化キーを使用する代わりに、お客様が管理する独自のキーを使用してデータを暗号化できます。クロスリージョンキーとクロスプロジェクトキーの両方がサポートされているため、CMEKキーのプロジェクトとは異なるバケット用のプロジェクトを選択できます。お客様が管理する独自のキーを使用する場合は、次の手順を実行します。
+
--
* アクティベーションウィザードでこの情報を追加できるように、キーリングとキー名が必要です。 https://cloud.google.com/kms/docs/cmek["お客様が管理する暗号化キーの詳細については、こちらをご覧ください"^]。
* これらの必要な権限がコネクタの役割に含まれていることを確認する必要があります。
+
[source, json]
----
cloudkms.cryptoKeys.get
cloudkms.cryptoKeys.getIamPolicy
cloudkms.cryptoKeys.list
cloudkms.cryptoKeys.setIamPolicy
cloudkms.keyRings.get
cloudkms.keyRings.getIamPolicy
cloudkms.keyRings.list
cloudkms.keyRings.setIamPolicy
----
* プロジェクトでGoogleの「Cloud Key Management Service（KMS）」APIが有効になっていることを確認する必要があります。を参照してください https://cloud.google.com/apis/docs/getting-started#enabling_apis["Google Cloudドキュメント：APIの有効化"] を参照してください。
* * CMEKの考慮事項：*
+
** HSM（ハードウェアバックアップ）キーとソフトウェア生成キーの両方がサポートされています。
** 新しく作成またはインポートしたCloud KMSキーは両方サポートされます。
** リージョンキーのみがサポートされています。グローバルキーはサポートされていません。
** 現在、「対称暗号化/復号化」の目的のみがサポートされています。
** BlueXPのバックアップとリカバリによって、ストレージアカウントに関連付けられたサービスエージェントには、「CryptoKey encrypter/Decrypter（roles/cloudkms.cryptoKeyEncrypterDecrypter）」IAMロールが割り当てられます。




--




== 新しいシステムでBlueXPのバックアップとリカバリを有効にする

作業環境のウィザードを完了して新しいCloud Volumes ONTAP システムを作成すると、BlueXPのバックアップとリカバリを有効にできます。

サービスアカウントがすでに設定されている必要があります。Cloud Volumes ONTAP システムの作成時にサービスアカウントを選択しなかった場合は、システムをオフにして、GCPコンソールからCloud Volumes ONTAP にサービスアカウントを追加する必要があります。

を参照してください https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-deploying-gcp.html["GCP での Cloud Volumes ONTAP の起動"^] を Cloud Volumes ONTAP 参照してください。

.手順
. [ 作業環境 ] ページで、 [ * 作業環境の追加 * ] をクリックし、画面の指示に従います。
. * 場所を選択 * ：「 * Google Cloud Platform * 」を選択します。
. * タイプを選択 * ：「 * Cloud Volumes ONTAP * 」（シングルノードまたはハイアベイラビリティ）を選択します。
. * 詳細と認証情報 * ：次の情報を入力します。
+
.. 使用するプロジェクトがデフォルトのプロジェクト(コネクタが存在するプロジェクト)と異なる場合は、「*プロジェクトを編集」をクリックして新しいプロジェクトを選択します。
.. クラスタ名を指定します。
.. サービスアカウント * スイッチを有効にし、事前定義されたストレージ管理者ロールを持つサービスアカウントを選択します。これは、バックアップと階層化を有効にするために必要です。
.. クレデンシャルを指定します。
+
GCP Marketplace のサブスクリプションが登録されていることを確認します。

+
image:screenshot_backup_to_gcp_new_env.png["作業環境ウィザードでサービスアカウントを有効にする方法を示すスクリーンショット。"]



. *サービス*：BlueXPのバックアップとリカバリサービスは有効なままにして、*[続行]*をクリックします。
+
image:screenshot_backup_to_gcp.png["は、作業環境ウィザードのBlueXPのバックアップとリカバリオプションを示しています。"]

. ウィザードの各ページを設定し、システムを導入します を参照してください https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-deploying-gcp.html["GCP での Cloud Volumes ONTAP の起動"^]。


.結果
システムでBlueXPのバックアップとリカバリが有効になっており、毎日作成したボリュームがバックアップされ、最新の30個のバックアップコピーが保持されます。



== 既存システムでBlueXPのバックアップとリカバリを有効にする

BlueXPのバックアップとリカバリは、いつでも作業環境から直接有効にできます。

.手順
. 作業環境を選択し、右パネルのバックアップ/リカバリサービスの横にある*有効化*をクリックします。
+
バックアップ先のGoogle Cloud StorageがCanvas上の作業環境として存在する場合は、クラスタをGoogle Cloud Storage作業環境にドラッグしてセットアップウィザードを開始できます。

+
image:screenshot_backup_cvo_enable.png["作業環境を選択すると表示されるBlueXPのバックアップとリカバリの[設定]ボタンのスクリーンショット。"]

. プロバイダの詳細を選択し、 * 次へ * ：
+
.. バックアップ用にGoogle Cloud Storageバケットを作成するGoogle Cloud Projectとリージョン。
.. Googleが管理するデフォルトの暗号化キーを使用する場合でも、お客様が管理する独自のキーを選択してデータの暗号化を管理する場合でも、CMEKを使用するには、キーリングとキー名が必要です。 https://cloud.google.com/kms/docs/cmek["お客様が管理する暗号化キーの詳細については、こちらをご覧ください"^]。
+
image:screenshot_backup_provider_settings_gcp.png["GCP にインストールされた Cloud Volumes ONTAP システムから Google Cloud Storage バケットにボリュームをバックアップする際のクラウドプロバイダの詳細を示すスクリーンショット。"]

+
プロジェクトには、事前定義された Storage Admin ロールを持つサービスアカウントが必要です。



. デフォルト・ポリシーに使用するバックアップ・ポリシーの詳細を入力し、［*次へ*］をクリックします。既存のポリシーを選択するか、各セクションで選択した内容を入力して新しいポリシーを作成できます。
+
.. デフォルトポリシーの名前を入力します。名前を変更する必要はありません。
.. バックアップスケジュールを定義し、保持するバックアップの数を選択します。 link:concept-ontap-backup-to-cloud.html#customizable-backup-schedule-and-retention-settings["選択可能な既存のポリシーのリストが表示されます"^]。
.. ONTAP 9.12.1以降を使用している場合は、特定の日数を経過したバックアップをアーカイブストレージに階層化して、さらにコストを最適化することができます。 link:concept-cloud-backup-policies.html["使用可能なBlueXPのバックアップとリカバリポリシーの設定の詳細については、こちらをご覧ください"^]。
+
image:screenshot_backup_policy_gcp.png["BlueXPのバックアップとリカバリの設定を示すスクリーンショット。この機能を有効または無効にして、バックアップの保持期間を選択できます。"]



. Select Volumes（ボリュームの選択）ページで、定義済みのバックアップポリシーを使用してバックアップするボリュームを選択します。特定のボリュームに異なるバックアップポリシーを割り当てる場合は、追加のポリシーを作成し、それらのボリュームにあとから適用できます。
+
** すべての既存ボリュームと今後追加されるすべてのボリュームをバックアップするには、[既存および将来のすべてのボリュームをバックアップ...]チェックボックスをオンにします。このオプションは、すべてのボリュームをバックアップし、新しいボリュームのバックアップを有効にする必要がないようにすることを推奨します。
** 既存のボリュームのみをバックアップする場合は、タイトル行（image:button_backup_all_volumes.png[""]）。
** 個々のボリュームをバックアップするには、各ボリュームのボックス（image:button_backup_1_volume.png[""]）。
+
image:screenshot_backup_select_volumes.png["バックアップするボリュームを選択するスクリーンショット。"]

** この作業環境に、この作業環境用に選択したバックアップスケジュールラベル（日次、週次など）に一致する読み取り/書き込みボリュームのローカルSnapshotコピーがある場合は、「Export existing Snapshot copies to object storage as backup copies」というプロンプトが追加で表示されます。ボリュームを完全に保護するために、履歴Snapshotをすべてバックアップファイルとしてオブジェクトストレージにコピーする場合は、このチェックボックスをオンにします。


. [バックアップをアクティブ化]*をクリックすると、選択した各ボリュームの初期バックアップの作成がBlueXPのバックアップとリカバリによって開始されます。


.結果
Google Cloud Storageバケットは、入力したGoogleアクセスキーとシークレットキーで指定されたサービスアカウントに自動的に作成され、そこにバックアップファイルが格納されます。ボリュームバックアップダッシュボードが表示され、バックアップの状態を監視できます。を使用して、バックアップジョブとリストアジョブのステータスを監視することもできます link:task-monitor-backup-jobs.html["［ジョブ監視］パネル"^]。

バックアップは、デフォルトで_Standard_storageクラスに関連付けられています。低コストのNearlineクラス、_Coldline_クラス、または_Archive_storageクラスを使用できます。ただし、ストレージクラスの設定には、BlueXPのバックアップとリカバリのUIではなく、Googleを使用します。Google のトピックを参照してください https://cloud.google.com/storage/docs/changing-default-storage-class["バケットのデフォルトのストレージクラスを変更する"^] を参照してください。



== 次の手順

* 可能です link:task-manage-backups-ontap.html["バックアップファイルとバックアップポリシーを管理"^]。バックアップの開始と停止、バックアップの削除、バックアップスケジュールの追加と変更などが含まれます。
* 可能です link:task-manage-backup-settings-ontap.html["クラスタレベルのバックアップの設定を管理します"^]。これには、バックアップをオブジェクトストレージにアップロードするためのネットワーク帯域幅の変更、将来のボリュームに対する自動バックアップ設定の変更などが含まれます。
* また可能です link:task-restore-backups-ontap.html["ボリューム、フォルダ、または個々のファイルをバックアップファイルからリストアする"^] Google の Cloud Volumes ONTAP システムやオンプレミスの ONTAP システムに接続できます。

