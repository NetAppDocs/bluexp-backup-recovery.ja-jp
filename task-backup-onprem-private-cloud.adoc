---
sidebar: sidebar 
permalink: task-backup-onprem-private-cloud.html 
keywords: backing up, back up, backup, backup on-prem ontap, on-prem, on-premises, back up volumes, cloud backup, StorageGRID 
summary: オンプレミスのONTAP システムからNetApp StorageGRID システムのオブジェクトストレージへのボリュームデータのバックアップを開始するには、いくつかの手順を実行します。 
---
= オンプレミスの ONTAP データの StorageGRID へのバックアップ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
オンプレミスのONTAP システムからNetApp StorageGRID システムのオブジェクトストレージへのボリュームデータのバックアップを開始するには、いくつかの手順を実行します。

「オンプレミス ONTAP システム」には、 FAS 、 AFF 、 ONTAP Select の各システムが含まれます。



== クイックスタート

これらの手順を実行すると、すぐに作業を開始できます。また、残りのセクションまでスクロールして詳細を確認することもできます。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["1つ"] 構成がサポートされていることを確認します
[role="quick-margin-list"]
* オンプレミスクラスタを検出して、BlueXPの作業環境に追加しました。を参照してください https://docs.netapp.com/us-en/cloud-manager-ontap-onprem/task-discovering-ontap.html["ONTAP クラスタの検出"^] を参照してください。
+
** クラスタで ONTAP 9.7P5 以降が実行されています。
** クラスタには SnapMirror ライセンスがあります。このライセンスは、 Premium Bundle または Data Protection Bundle に含まれています。
** クラスタから StorageGRID およびコネクタへの必要なネットワーク接続が確立されている必要があります。


* コネクタがオンプレミスにインストールされている。
+
** コネクタは、インターネットに接続するかどうかに関係なく、サイトにインストールできます。
** コネクタのネットワークを使用すると、 ONTAP クラスタおよび StorageGRID へのアウトバウンド HTTPS 接続が可能になります。


* を購入済みである link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license["アクティブ化されます"^] ネットアップが提供するBlueXPバックアップ/リカバリのBYOLライセンス
* StorageGRID バージョン 10.3 以降では、 S3 権限を持つアクセスキーが設定されています。


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["2 つ"] システムでBlueXPのバックアップとリカバリを有効にします
[role="quick-margin-para"]
ソースONTAP 作業環境を選択し、右パネルのバックアップ/リカバリサービスの横にある*Enable>Backup Volumes]をクリックして、セットアップ・ウィザードに従います。

[role="quick-margin-para"]
image:screenshot_backup_onprem_enable.png["作業環境を選択した後に使用できる[バックアップとリカバリの有効化]ボタンを示すスクリーンショット。"]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["3つ"] StorageGRID の詳細を入力します
[role="quick-margin-para"]
プロバイダとしてStorageGRID を選択し、StorageGRID サーバとS3テナントアカウントの詳細を入力します。また、ボリュームが配置されている ONTAP クラスタ内の IPspace を指定する必要があります。

[role="quick-margin-para"]
image:screenshot_backup_provider_settings_storagegrid.png["ONTAP クラスタから StorageGRID にボリュームをバックアップする際のクラウドプロバイダの詳細を示すスクリーンショット。"]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-4.png["4."] デフォルトのバックアップポリシーを定義
[role="quick-margin-para"]
デフォルトポリシーでは、毎日ボリュームがバックアップされ、各ボリュームの最新の 30 個のバックアップコピーが保持されます。毎時、毎日、毎週、毎月、または毎年のバックアップに変更します。 または、オプションを追加するシステム定義のポリシーを1つ選択します。保持するバックアップコピーの数を変更することもできます。

[role="quick-margin-para"]
クラスタがONTAP 9.12.1以降を使用しており、StorageGRID システムがバージョン11.4以降を使用している場合は、特定の日数が経過した古いバックアップをパブリッククラウドのアーカイブ階層に階層化して、コストをさらに最適化することができます。現在、AWS S3 Glacier Deep ArchiveまたはAzure Archiveストレージ階層がサポートされています。

[role="quick-margin-para"]
クラスタがONTAP 9.11.1以降を使用している場合は、_DataLockとRansomware Protection_settingsのいずれかを設定することで、バックアップを削除攻撃やランサムウェア攻撃から保護することができます。 link:concept-cloud-backup-policies.html["使用可能なBlueXPのバックアップとリカバリポリシーの設定の詳細については、こちらをご覧ください"^]。

[role="quick-margin-para"]
image:screenshot_backup_onprem_policy.png["BlueXPのバックアップとリカバリの設定を示すスクリーンショットで、バックアップスケジュールと保持期間を選択できます。"]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-5.png["5 つ"] バックアップするボリュームを選択します
[role="quick-margin-para"]
Select Volumes （ボリュームの選択）ページで、デフォルトのバックアップポリシーを使用してバックアップするボリュームを特定します。特定のボリュームに異なるバックアップポリシーを割り当てる場合は、あとから追加のポリシーを作成してボリュームに適用できます。

[role="quick-margin-para"]
S3バケットは、入力したS3アクセスキーとシークレットキーで指定されたサービスアカウントのStorageGRID に自動的に作成され、バックアップファイルが格納されます。



== 要件

オンプレミスボリュームを StorageGRID にバックアップする前に、次の要件を確認し、サポートされている構成であることを確認してください。

次の図は、オンプレミスのONTAP システムをStorageGRID にバックアップする場合の各コンポーネントと、それらの間の準備に必要な接続を示しています。

image:diagram_cloud_backup_onprem_storagegrid.png["BlueXPのバックアップおよびリカバリが、ソースシステム上のボリュームおよびバックアップファイルが配置されているデスティネーションストレージとどのように通信するかを示す図。"]

コネクタとオンプレミスのONTAP システムがインターネットにアクセスできないオンプレミスの場所（「ダークサイト」）にインストールされている場合は、StorageGRID システムをオンプレミスの同じデータセンターに配置する必要があります。ダークサイトの構成では、古いバックアップファイルをパブリッククラウドにアーカイブすることはできません。



=== ONTAP クラスタの準備

ボリュームデータのバックアップを開始する前に、BlueXPでオンプレミスONTAP クラスタを検出する必要があります。

https://docs.netapp.com/us-en/cloud-manager-ontap-onprem/task-discovering-ontap.html["クラスタの検出方法について説明します"^]。

ONTAP の要件::
+
--
* ONTAP 9.7P5以降を使用することを推奨します。ONTAP 9.8P13以降を使用することを推奨します。
* SnapMirror ライセンス（ Premium Bundle または Data Protection Bundle に含まれます）。
+
*注：* BlueXPのバックアップとリカバリを使用する場合、「Hybrid Cloud Bundle」は必要ありません。

+
方法を参照してください https://docs.netapp.com/us-en/ontap/system-admin/manage-licenses-concept.html["クラスタライセンスを管理します"^]。

* 時間とタイムゾーンが正しく設定されている。
+
方法を参照してください https://docs.netapp.com/us-en/ontap/system-admin/manage-cluster-time-concept.html["クラスタ時間を設定します"^]。



--
クラスタネットワークの要件::
+
--
* ONTAP クラスタは、バックアップおよびリストア処理のために、ユーザ指定のポートをクラスタ間LIFからStorageGRID ゲートウェイノードに介してHTTPS接続を開始します。ポートはバックアップのセットアップ時に設定できます。
+
ONTAP は、オブジェクトストレージとの間でデータの読み取りと書き込みを行います。オブジェクトストレージが開始されることはなく、応答するだけです。

* ONTAP では、コネクタからクラスタ管理 LIF へのインバウンド接続が必要です。コネクタは必ずオンプレミスに配置してください。
* クラスタ間 LIF は、バックアップ対象のボリュームをホストする各 ONTAP ノードに必要です。LIF は、 ONTAP がオブジェクトストレージへの接続に使用する IPspace に関連付けられている必要があります。 https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IPspace の詳細については、こちらをご覧ください"^]。
+
BlueXPのバックアップとリカバリをセットアップするときに、使用するIPspaceを指定するように求められます。各 LIF を関連付ける IPspace を選択する必要があります。これは、「デフォルト」の IPspace または作成したカスタム IPspace です。

* ノードのクラスタ間 LIF はオブジェクトストアにアクセスできます（コネクタが「ダーク」サイトに設置されている場合は不要）。
* ボリュームが配置されている Storage VM に DNS サーバが設定されている。方法を参照してください https://docs.netapp.com/us-en/ontap/networking/configure_dns_services_auto.html["SVM 用に DNS サービスを設定"^]。
* をデフォルトとは異なる IPspace を使用している場合は、オブジェクトストレージへのアクセスを取得するために静的ルートの作成が必要になることがあります。
* 必要に応じてファイアウォールルールを更新して、指定したポート（通常はポート443）を介してONTAP からオブジェクトストレージへのBlueXPバックアップ/リカバリサービスの接続と、Storage VMからDNSサーバへのポート53（TCP / UDP）経由の名前解決トラフィックを許可します。


--




=== StorageGRID を準備しています

StorageGRID は、次の要件を満たす必要があります。を参照してください https://docs.netapp.com/us-en/storagegrid-116/["StorageGRID のドキュメント"^] を参照してください。

サポートされている StorageGRID のバージョン:: StorageGRID 10.3 以降がサポートされます。
+
--
DataLockとRansomware Protectionをバックアップに使用するには、StorageGRID システムでバージョン11.6.0.3以降が実行されている必要があります。

古いバックアップをクラウドアーカイブストレージに階層化するには、StorageGRID システムでバージョン11.3以降が実行されている必要があります。

--
S3 クレデンシャル:: StorageGRID ストレージへのアクセスを制御するS3テナントアカウントを作成しておく必要があります。 https://docs.netapp.com/us-en/storagegrid-116/admin/creating-tenant-account.html["詳細については、StorageGRID のドキュメントを参照してください"^]。
+
--
StorageGRID へのバックアップを設定する際、テナントアカウントのS3アクセスキーとシークレットキーを入力するようにバックアップウィザードで求められます。テナントアカウントを使用すると、バックアップの格納に使用するStorageGRID バケットをBlueXPのバックアップとリカバリで認証してアクセスできるようになります。StorageGRID が誰が要求を行うかを認識できるようにするには、キーが必要です。

これらのアクセスキーは、次の権限を持つユーザに関連付ける必要があります。

[source, json]
----
"s3:ListAllMyBuckets",
"s3:ListBucket",
"s3:GetObject",
"s3:PutObject",
"s3:DeleteObject",
"s3:CreateBucket"
----
--
オブジェクトのバージョン管理:: オブジェクトストアバケットでは、StorageGRID オブジェクトのバージョン管理を手動で有効にしないでください。




=== コネクタの作成または切り替え

StorageGRID にデータをバックアップするときは、オンプレミスのコネクタが必要です。新しいコネクターをインストールするか、現在選択されているコネクターがオンプレミスにあることを確認する必要があります。コネクタは、インターネットに接続するかどうかに関係なく、サイトにインストールできます。

* https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-connectors.html["コネクタについて説明します"^]
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-quick-start-connector-on-prem.html["インターネットにアクセスできる Linux ホストにコネクタをインストールしています"^]
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-quick-start-private-mode.html["インターネットにアクセスできない Linux ホストにコネクタをインストールしています"^]



NOTE: BlueXPコネクタには、BlueXPのバックアップとリカバリ機能が組み込まれています。インターネットに接続されていないサイトにインストールする場合は、コネクタソフトウェアを定期的に更新して、新しい機能にアクセスする必要があります。を確認します link:whats-new.html["BlueXPのバックアップとリカバリの最新情報"] BlueXPのバックアップとリカバリの各リリースの新機能を確認するには、次の手順を実行します https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-managing-connectors.html#upgrade-the-connector-when-using-private-mode["Connector ソフトウェアをアップグレードします"^] 新しい機能を使用する場合。

インターネットに接続されていないサイトにコネクタがインストールされている場合は、BlueXPのバックアップとリカバリの設定データのローカルバックアップを定期的に作成することを強く推奨します。 link:reference-backup-cbs-db-in-dark-site.html["BlueXPのバックアップデータとリカバリデータをダークサイトにバックアップする方法を説明します"^]。



=== コネクタのネットワークを準備しています

コネクタに必要なネットワーク接続があることを確認します。

.手順
. コネクタが取り付けられているネットワークで次の接続が有効になっていることを確認します。
+
** ポート443からStorageGRID ゲートウェイノードへのHTTPS接続
** ONTAP クラスタ管理 LIF へのポート 443 経由の HTTPS 接続
** BlueXPのバックアップとリカバリへのポート443経由のアウトバウンドインターネット接続（「ダーク」サイトにコネクタがインストールされている場合は不要）






=== 古いバックアップファイルをパブリッククラウドストレージにアーカイブする準備をしています

古いバックアップファイルをアーカイブストレージに階層化すると、不要なバックアップに低コストのストレージクラスを使用することで、コストを削減できます。StorageGRID は、アーカイブストレージを提供しないオンプレミス（プライベートクラウド）の解決策 ですが、古いバックアップファイルをパブリッククラウドのアーカイブストレージに移動できます。この方法で使用した場合、クラウドストレージに階層化されたデータ、またはクラウドストレージから復元されたデータは、StorageGRID とクラウドストレージの間を移動します。BlueXPはこのデータ転送には関与しません。

現在のサポートでは、AWS_S3 Glacier Deep Archive_or_Azure Archive_storageにバックアップをアーカイブできます。

* ONTAP 要件*

* クラスタでONTAP 9.12.1以降が使用されている必要があります


* StorageGRID 要件*

* StorageGRID が11.4以降を使用している必要があります
* StorageGRID はである必要があります https://docs.netapp.com/us-en/cloud-manager-storagegrid/task-discover-storagegrid.html["BlueXP Canvasで検出され、使用可能になりました"^]。


* Amazon S3の要件*

* アーカイブ済みバックアップを格納するストレージスペースには、Amazon S3アカウントを登録する必要があります。
* AWS S3 GlacierまたはS3 Glacier Deep Archiveストレージにバックアップを階層化することもできます。 link:reference-aws-backup-tiers.html["AWSアーカイブ階層の詳細は、こちらをご覧ください"^]。
* StorageGRID には、バケットへのフルコントロールアクセスが必要です (`s3:*`）。ただし、これができない場合は、バケットポリシーで次のS3権限をStorageGRID に付与する必要があります。
+
** `s3:AbortMultipartUpload`
** `s3:DeleteObject`
** `s3:GetObject`
** `s3:ListBucket`
** `s3:ListBucketMultipartUploads`
** `s3:ListMultipartUploadParts`
** `s3:PutObject`
** `s3:RestoreObject`




* Azure Blob要件*

* アーカイブ済みバックアップを格納するストレージスペースに対するAzureサブスクリプションに登録する必要があります。
* アクティブ化ウィザードでは、既存のリソースグループを使用して、バックアップを保存するBLOBコンテナを管理するか、新しいリソースグループを作成することができます。


クラスタのバックアップポリシーのアーカイブ設定を定義するときは、クラウドプロバイダのクレデンシャルを入力し、使用するストレージクラスを選択します。クラスタのバックアップをアクティブ化すると、BlueXPのバックアップとリカバリによってクラウドバケットが作成されます。AWSおよびAzureアーカイブストレージに必要な情報を次に示します。

image:screenshot_sg_archive_to_cloud.png["バックアップファイルをStorageGRID からAWS S3またはAzure Blobにアーカイブするために必要な情報のスクリーンショット。"]

選択したアーカイブポリシーの設定では、StorageGRID で情報ライフサイクル管理（ILM）ポリシーが生成され、「ルール」として追加されます。既存のアクティブなILMポリシーがある場合は、新しいルールがILMポリシーに追加されてデータがアーカイブ階層に移動されます。「ドラフト」状態の既存のILMポリシーがある場合は、新しいILMポリシーを作成およびアクティブ化できません。 https://docs.netapp.com/us-en/storagegrid-116/ilm/index.html["StorageGRID のILMポリシーとルールに関する詳細情報"^]。



=== ライセンス要件

クラスタでBlueXPのバックアップとリカバリをアクティブ化するには、ネットアップからBlueXPのバックアップとリカバリのBYOLライセンスを購入してアクティブ化する必要があります。このライセンスはアカウント用であり、複数のシステムで使用できます。

ネットアップから提供されるシリアル番号を使用して、ライセンスの期間と容量にサービスを利用できるようにする必要があります。 link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license["BYOL ライセンスの管理方法について説明します"]。


TIP: PAYGO ライセンスは、ファイルを StorageGRID にバックアップする場合にはサポートされません。



== BlueXPからStorageGRID へのバックアップとリカバリを有効にします

BlueXPのバックアップとリカバリは、オンプレミスの作業環境からいつでも直接実行できます。

.手順
. キャンバスからオンプレミスの作業環境を選択し、右パネルのバックアップおよびリカバリサービスの横にある*Enable>バックアップボリューム*をクリックします。
+
バックアップ先のStorageGRID がキャンバス上の作業環境として存在する場合、クラスタをStorageGRID 作業環境にドラッグしてセットアップウィザードを開始できます。

+
image:screenshot_backup_onprem_enable.png["作業環境を選択した後に使用できる[バックアップとリカバリの有効化]ボタンを示すスクリーンショット。"]

. プロバイダとして * StorageGRID * を選択し、 * Next * をクリックして、プロバイダの詳細を入力します。
+
.. StorageGRID ゲートウェイノードのFQDN。
.. ONTAP がStorageGRID とのHTTPS通信に使用するポート。
.. バックアップを格納するバケットへのアクセスに使用するアクセスキーとシークレットキー。
.. バックアップするボリュームが配置されている ONTAP クラスタ内の IPspace 。この IPspace のクラスタ間 LIF には、アウトバウンドのインターネットアクセスが必要です（コネクタが「ダーク」サイトにインストールされている場合は不要です）。
+
正しいIPspaceを選択すると、BlueXPのバックアップとリカバリでONTAP からStorageGRID オブジェクトストレージへの接続をセットアップできます。

+
image:screenshot_backup_provider_settings_storagegrid.png["オンプレミスのクラスタから StorageGRID ストレージにボリュームをバックアップする際のクラウドプロバイダの詳細を示すスクリーンショット。"]



. デフォルト・ポリシーに使用するバックアップ・ポリシーの詳細を入力し、［*次へ*］をクリックします。既存のポリシーを選択するか、各セクションで選択した内容を入力して新しいポリシーを作成できます。
+
.. デフォルトポリシーの名前を入力します。名前を変更する必要はありません。
.. バックアップスケジュールを定義し、保持するバックアップの数を選択します。 link:concept-ontap-backup-to-cloud.html#customizable-backup-schedule-and-retention-settings["選択可能な既存のポリシーのリストが表示されます"^]。
.. クラスタがONTAP 9.11.1以降を使用している場合は、_DataLockとランサムウェアによる攻撃からバックアップを保護するように設定できます。_DataLock_はバックアップファイルの変更や削除を防止します。_Ransomware protection_scanはバックアップファイルをスキャンして、バックアップファイルにランサムウェア攻撃の痕跡がないかどうかを確認します。 link:concept-cloud-backup-policies.html#datalock-and-ransomware-protection["使用可能なDataLock設定の詳細については、こちらを参照してください"^]。
.. クラスタがONTAP 9.12.1以降を使用しており、StorageGRID システムがバージョン11.4以降を使用している場合は、特定の日数が経過したあとに古いバックアップをパブリッククラウドのアーカイブ階層に階層化することを選択できます。現在、AWS S3 Glacier Deep ArchiveまたはAzure Archiveストレージ階層がサポートされています。 <<古いバックアップファイルをパブリッククラウドストレージにアーカイブする準備をしています,この機能を使用するためのシステムの設定方法を参照してください>>。
+
image:screenshot_backup_onprem_policy.png["BlueXPのバックアップとリカバリの設定を示すスクリーンショットで、バックアップスケジュールと保持期間を選択できます。"]

+
*重要：* DataLockを使用する場合は、BlueXPのバックアップとリカバリをアクティブ化するときに最初のポリシーでDataLockを有効にする必要があります。



. Select Volumes（ボリュームの選択）ページで、定義済みのバックアップポリシーを使用してバックアップするボリュームを選択します。特定のボリュームに異なるバックアップポリシーを割り当てる場合は、追加のポリシーを作成し、それらのボリュームにあとから適用できます。
+
** すべての既存ボリュームと今後追加されるすべてのボリュームをバックアップするには、[既存および将来のすべてのボリュームをバックアップ...]チェックボックスをオンにします。このオプションは、すべてのボリュームをバックアップし、新しいボリュームのバックアップを有効にする必要がないようにすることを推奨します。
** 既存のボリュームのみをバックアップする場合は、タイトル行（image:button_backup_all_volumes.png[""]）。
** 個々のボリュームをバックアップするには、各ボリュームのボックス（image:button_backup_1_volume.png[""]）。
+
image:screenshot_backup_select_volumes.png["バックアップするボリュームを選択するスクリーンショット。"]

** この作業環境に、この作業環境用に選択したバックアップスケジュールラベル（日次、週次など）に一致する読み取り/書き込みボリュームのローカルSnapshotコピーがある場合は、「Export existing Snapshot copies to object storage as backup copies」というプロンプトが追加で表示されます。ボリュームを完全に保護するために、履歴Snapshotをすべてバックアップファイルとしてオブジェクトストレージにコピーする場合は、このチェックボックスをオンにします。


. [バックアップをアクティブ化]*をクリックすると、選択した各ボリュームの初期バックアップの作成がBlueXPのバックアップとリカバリによって開始されます。


.結果
S3 バケットは、入力した S3 アクセスキーとシークレットキーで指定されたサービスアカウントに自動的に作成され、そこにバックアップファイルが格納されます。ボリュームバックアップダッシュボードが表示され、バックアップの状態を監視できます。を使用して、バックアップジョブとリストアジョブのステータスを監視することもできます link:task-monitor-backup-jobs.html["［ジョブ監視］パネル"^]。



== 次の手順

* 可能です link:task-manage-backups-ontap.html["バックアップファイルとバックアップポリシーを管理"^]。バックアップの開始と停止、バックアップの削除、バックアップスケジュールの追加と変更などが含まれます。
* 可能です link:task-manage-backup-settings-ontap.html["クラスタレベルのバックアップの設定を管理します"^]。これには、クラウドストレージへのアクセスにONTAP で使用するストレージキーの変更、オブジェクトストレージへのバックアップのアップロードに使用できるネットワーク帯域幅の変更、将来のボリュームに対する自動バックアップ設定の変更などが含まれます。
* また可能です link:task-restore-backups-ontap.html["ボリューム、フォルダ、または個々のファイルをバックアップファイルからリストアする"^] オンプレミスのONTAP システムへの移行をサポート

