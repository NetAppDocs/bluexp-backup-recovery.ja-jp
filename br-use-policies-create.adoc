---
sidebar: sidebar 
permalink: br-use-policies-create.html 
keywords: backing up, back up, backup, backup on-prem ontap, policy, policies, backup policies, cloud backup, aws, aws s3, azure, google cloud 
summary: BlueXP backup and recoveryでは、バックアップの頻度、バックアップの実行時間、保持されるバックアップ ファイルの数を制御する独自のポリシーを作成します。 
---
= BlueXP backup and recoveryでバックアップを管理するポリシーを作成および管理します
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
BlueXP backup and recoveryでは、バックアップの頻度、バックアップの実行時間、保持されるバックアップ ファイルの数を制御する独自のポリシーを作成します。


NOTE: これらのオプションと構成セクションの一部は、すべてのワークロードで使用できるわけではありません。

SnapCenterからリソースをインポートする場合、 SnapCenterで使用されるポリシーとBlueXP backup and recoveryで使用されるポリシーとの間に若干の違いが生じる可能性があります。を参照して link:reference-policy-differences-snapcenter.html["SnapCenterとBlueXP backup and recoveryのポリシーの違い"]

ポリシーに関連する次の目標を達成できます。

* ローカルスナップショットポリシーを作成する
* セカンダリストレージへのレプリケーションのポリシーを作成する
* オブジェクトストレージ設定のポリシーを作成する
* 詳細なポリシー設定を構成する
* ポリシーを編集する
* ポリシーの削除




== ポリシーを表示します

. BlueXP backup and recoveryメニューから、[ポリシー] を選択します。
+
image:screen-br-policies.png["ポリシーページ"]

. これらのポリシーの詳細を確認してください。
+
** *ワークロード*: 例としては、Microsoft SQL Server、ボリューム、VMware、Kubernetes などがあります。
** *バックアップ タイプ*: 例としては、完全バックアップやログ バックアップなどがあります。
** *アーキテクチャ*: 例としては、ローカル スナップショット、ファンアウト、カスケード、ディスク間、ディスクからオブジェクト ストアなどがあります。
** *保護されているリソース*: そのワークロード上のリソースの合計数のうち、保護されているリソースの数を表示します。
** *ランサムウェア保護*: ポリシーに、ローカル スナップショットのスナップショット ロック、セカンダリ ストレージのスナップショット ロック、またはオブジェクト ストレージの DataLock ロックが含まれているかどうかを示します。






== ポリシーを作成する

ローカルスナップショット、セカンダリストレージへのレプリケーション、オブジェクトストレージへのバックアップを管理するポリシーを作成できます。3-2-1戦略の一環として、Microsoft SQL Serverインスタンスまたはデータベースのスナップショットコピーをプライマリストレージシステムに作成します。

*必須のBlueXPロール* 組織管理者、フォルダまたはプロジェクト管理者、バックアップとリカバリのスーパー管理者、バックアップとリカバリのバックアップ管理者。 link:reference-roles.html["バックアップとリカバリの役割と権限"] 。  https://docs.netapp.com/us-en/bluexp-setup-admin/reference-iam-predefined-roles.html["すべてのサービスに対するBlueXPのアクセスロールについて学ぶ"^] 。

.作業を開始する前に
セカンダリストレージへのレプリケーションを計画しており、ローカルスナップショットまたはリモートONTAPセカンダリストレージでスナップショットロックを使用する場合は、まずクラスタレベルでONTAPコンプライアンスクロックを初期化する必要があります。これは、ポリシーでスナップショットロックを有効にするための要件です。

これを行う方法については、以下を参照してください。  https://docs.netapp.com/us-en/ontap/snaplock/initialize-complianceclock-task.html["ONTAPのコンプライアンスクロックを初期化する"^] 。

スナップショットロック全般については、以下を参照してください。  https://docs.netapp.com/us-en/ontap/snaplock/snapshot-lock-concept.html["ONTAPのスナップショットロック"^] 。

.手順
. BlueXP backup and recoveryメニューから、[ポリシー] を選択します。
. [ポリシー] ページで、[新しいポリシーの作成] を選択します。
+
image:screen-br-policies-new-nodata.png["新しいポリシー作成のスクリーンショット"]

. 「ポリシー」ページで、次の情報を入力します。
+
** *詳細*セクション:
+
*** このバージョンでは、デフォルトで「Microsoft SQL Server」のワークロード タイプが選択されています。
*** ポリシー名を入力します。


** *バックアップ アーキテクチャ* セクション: 下矢印を選択し、ファンアウト、カスケード、ディスク間などのバックアップのアーキテクチャを選択します。
+
*** *ローカルスナップショット*: 選択したボリュームのローカルスナップショットです。ローカルスナップショットはデータ保護戦略の重要な要素であり、特定の時点におけるデータの状態をキャプチャします。これにより、ワークロードが実行されている本番ボリュームの読み取り専用のポイントインタイムコピーが作成されます。スナップショットは、前回のスナップショット以降のファイルの変更のみを記録するため、ストレージ容量の消費は最小限に抑えられ、パフォーマンスのオーバーヘッドもごくわずかです。ローカルスナップショットは、データの損失や破損からの復旧や、災害復旧のためのバックアップの作成に使用できます。
*** *3-2-1ファンアウト*：プライマリストレージ（ディスク）からセカンダリストレージ（ディスク）へ、そしてクラウド（オブジェクトストア）へ。ONTAPからONTAP 、 ONTAPからオブジェクトONTAPといった異なるストレージシステム間でデータの複数のコピーを作成します。クラウドハイパースケーラーのオブジェクトストア、またはプライベートオブジェクトストア（ StorageGRID）を利用できます。これらの構成は、最適なデータ保護とディザスタリカバリの実現に役立ちます。
*** *3-2-1カスケード*：プライマリストレージ（ディスク）からセカンダリストレージ（ディスク）へ、そしてプライマリストレージ（ディスク）からクラウドストレージ（オブジェクトストア）へ。これは、クラウドハイパースケーラーのオブジェクトストア、またはプライベートオブジェクトストア（ StorageGRID）のいずれかになります。これにより、複数のシステムにわたるデータレプリケーションのチェーンが作成され、冗長性と信頼性が確保されます。
*** *ディスクツーディスク*：プライマリストレージ（ディスク）からセカンダリストレージ（ディスク）へ。ONTAPONTAPONTAPへのデータ保護戦略は、2つのONTAPシステム間でデータを複製することで、高可用性とディザスタリカバリを実現します。これは通常、同期レプリケーションと非同期レプリケーションの両方をサポートするSnapMirrorを使用して実現されます。この方法により、データは継続的に更新され、複数の場所で利用可能になり、データ損失に対する堅牢な保護が実現されます。
*** *ディスクツーオブジェクトストア*：プライマリストレージ（ディスク）からクラウド（オブジェクトストア）へ。ONTAPシステムからAWS S3、Azure Blob Storage、 StorageGRIDなどのONTAPストレージシステムにデータを複製します。これは通常、 SnapMirror Cloudを使用して実現されます。SnapMirror Cloudは、最初のベースライン転送後に変更されたデータブロックのみを転送することで、永久増分バックアップを提供します。これは、クラウドハイパースケーラーのオブジェクトストアまたはプライベートオブジェクトストア（ StorageGRID）のいずれかです。この方法は長期的なデータ保持とアーカイブに最適で、コスト効率が高くスケーラブルなデータ保護ソリューションを提供します。
*** *ディスク間のファンアウト*: プライマリ ストレージ (ディスク) からセカンダリ ストレージ (ディスク) へ、およびプライマリ ストレージ (ディスク) からセカンダリ ストレージ (ディスク) へ。
+

NOTE: ディスク間ファンアウト オプションには複数のセカンダリ設定を構成できます。









=== ローカルスナップショットポリシーを作成する

ローカル スナップショットの情報を提供します。

* スナップショットスケジュールを選択するには、「スケジュールを追加」オプションを選択します。スケジュールは最大5つまで作成できます。
* *スナップショット頻度*: 毎時、毎日、毎週、毎月、毎年から頻度を選択します。Kubernetesワークロードでは毎年の頻度は選択できません。
* *スナップショットの保持*: 保持するスナップショットの数を入力します。
* *ログバックアップを有効にする*: (Kubernetesワークロードでは利用できません) ログをバックアップするオプションをオンにし、ログバックアップの頻度と保持期間を設定します。これを行うには、ログバックアップが既に設定されている必要があります。を参照して link:br-start-configure.html["ログディレクトリを構成する"]
* *プロバイダー*: (Kubernetes ワークロードのみ) Kubernetes アプリケーション リソースをホストするストレージ プロバイダーを選択します。
* *バックアップターゲット*: (Kubernetes ワークロードのみ) バックアップのターゲットシステムを選択します。これはスナップショットが保存されるストレージシステムです。バックアップ環境からターゲットにアクセスできることを確認してください。
* オプションで、スケジュールの右側にある *詳細* を選択して、 SnapMirrorラベルを設定し、スナップショットのロックを有効にします (Kubernetes ワークロードでは使用できません)。
+
** * SnapMirrorラベル*：ラベルは、関係の保持ルールに従って指定されたスナップショットを転送するためのマーカーとして機能します。スナップショットにラベルを追加すると、そのスナップショットはSnapMirrorレプリケーションのターゲットとしてマークされます。
** *時間からのオフセット*: スナップショットを毎時0分から何分後に取得するかを入力します。例えば、「*15*」と入力すると、毎時0分15分にスナップショットが取得されます。
** *サイレントアワーを有効にする*：サイレントアワーを有効にするかどうかを選択します。サイレントアワーとは、スナップショットが作成されない時間帯のことで、バックアッププロセスに干渉されることなくメンテナンスなどの操作を行うことができます。これは、ピーク時やメンテナンス期間中のシステム負荷を軽減するのに役立ちます。
** *スナップショットのロックを有効にする*：改ざん防止スナップショットを有効にするかどうかを選択します。このオプションを有効にすると、指定された保持期間が経過するまで、スナップショットは削除または変更できなくなります。この機能は、ランサムウェア攻撃からデータを保護し、データの整合性を確保するために不可欠です。
** *スナップショットのロック期間*: スナップショットをロックする日数、月数、または年数を入力します。






=== セカンダリ設定（セカンダリストレージへのレプリケーション）のポリシーを作成する

セカンダリストレージへのレプリケーションに関する情報を入力してください。ローカルスナップショット設定のスケジュール情報は、セカンダリ設定に表示されます。これらの設定はKubernetesワークロードでは使用できません。

* *バックアップ*: 時間ごと、日ごと、週ごと、月ごと、または年ごとの頻度を選択します。
* *バックアップ対象*: バックアップの対象となるセカンダリ ストレージ上のターゲット システムを選択します。
* *保持*: 保持するスナップショットの数を入力します。
* *スナップショットのロックを有効にする*: 改ざん防止スナップショットを有効にするかどうかを選択します。
* *スナップショットのロック期間*: スナップショットをロックする日数、月数、または年数を入力します。
* *二次転送*:
+
** * ONTAP転送スケジュール - インライン* オプションはデフォルトで選択されており、スナップショットはセカンダリストレージシステムに即座に転送されます。バックアップをスケジュールする必要はありません。
** その他のオプション: 延期転送を選択した場合、転送は即時に行われず、スケジュールを設定できます。






=== オブジェクトストレージ設定のポリシーを作成する

オブジェクトストレージへのバックアップに関する情報を指定します。これらの設定は、Kubernetes ワークロードでは「バックアップ設定」と呼ばれます。


NOTE: 表示されるフィールドは、選択したプロバイダーとアーキテクチャによって異なります。



==== AWSオブジェクトストレージのポリシーを作成する

次のフィールドに情報を入力します。

* *プロバイダー*: *AWS* を選択します。
* *AWS アカウント*: AWS アカウントを選択します。
* *バックアップ対象*: 登録済みのS3オブジェクトストレージターゲットを選択します。バックアップ環境からターゲットにアクセスできることを確認してください。
* *IPspace*: バックアップ操作に使用するIPspaceを選択します。複数のIPspaceがあり、どのIPspaceをバックアップに使用するかを制御したい場合に便利です。
* *スケジュール設定*: ローカルスナップショットに設定されたスケジュールを選択します。スケジュールはローカルスナップショットのスケジュールに基づいて設定されているため、削除は可能ですが、追加はできません。
* *保持コピー数*: 保持するスナップショットの数を入力します。
* *実行時間*: データをオブジェクト ストレージにバックアップするためのONTAP転送スケジュールを選択します。
* *オブジェクト ストアからアーカイブ ストレージにバックアップを階層化します*: バックアップをアーカイブ ストレージ (AWS Glacier など) に階層化することを選択した場合は、階層オプションとアーカイブする日数を選択します。




==== Microsoft Azure オブジェクト ストレージのポリシーを作成する

次のフィールドに情報を入力します。

* *プロバイダー*: *Azure* を選択します。
* *Azure サブスクリプション*: 検出された Azure サブスクリプションを選択します。
* *Azure リソース グループ*: 検出された Azure リソース グループから選択します。
* *バックアップ対象*: 登録済みのオブジェクトストレージターゲットを選択します。バックアップ環境からターゲットにアクセスできることを確認してください。
* *IPspace*: バックアップ操作に使用するIPspaceを選択します。複数のIPspaceがあり、どのIPspaceをバックアップに使用するかを制御したい場合に便利です。
* *スケジュール設定*: ローカルスナップショットに設定されたスケジュールを選択します。スケジュールはローカルスナップショットのスケジュールに基づいて設定されているため、削除は可能ですが、追加はできません。
* *保持コピー数*: 保持するスナップショットの数を入力します。
* *実行時間*: データをオブジェクト ストレージにバックアップするためのONTAP転送スケジュールを選択します。
* *オブジェクト ストアからアーカイブ ストレージにバックアップを階層化します*: バックアップをアーカイブ ストレージに階層化する場合は、階層オプションとアーカイブする日数を選択します。




==== StorageGRIDオブジェクトストレージのポリシーを作成する

次のフィールドに情報を入力します。

* *プロバイダー*：* StorageGRID *を選択します。
* * StorageGRID認証情報*: 検出された認証情報の中から、 StorageGRID認証情報を選択します。これらの認証情報は、 StorageGRIDオブジェクトストレージシステムへのアクセスに使用され、「設定」オプションで入力されたものです。
* *バックアップ対象*: 登録済みのS3オブジェクトストレージターゲットを選択します。バックアップ環境からターゲットにアクセスできることを確認してください。
* *IPspace*: バックアップ操作に使用するIPspaceを選択します。複数のIPspaceがあり、どのIPspaceをバックアップに使用するかを制御したい場合に便利です。
* *スケジュール設定*: ローカルスナップショットに設定されたスケジュールを選択します。スケジュールはローカルスナップショットのスケジュールに基づいて設定されているため、削除は可能ですが、追加はできません。
* *保持コピー数*: 各頻度で保持するスナップショットの数を入力します。
* *オブジェクト ストレージの転送スケジュール*: (Kubernetes ワークロードでは使用できません) ONTAP転送スケジュールを選択して、データをオブジェクト ストレージにバックアップします。
* *整合性スキャンを有効にする*: (Kubernetesワークロードでは利用できません) オブジェクトストレージで整合性スキャン（スナップショットロック）を有効にするかどうかを選択します。これにより、バックアップの有効性が確保され、正常に復元できるようになります。整合性スキャンの頻度は、デフォルトで7日間に設定されています。バックアップが変更または削除されるのを防ぐには、*整合性スキャン*オプションを選択してください。スキャンは最新のスナップショットに対してのみ実行されます。最新のスナップショットに対して整合性スキャンを有効または無効にすることができます。
* *オブジェクト ストアからアーカイブ ストレージにバックアップを階層化します*: (Kubernetes ワークロードでは使用できません) バックアップをアーカイブ ストレージに階層化する場合は、階層オプションとアーカイブする日数を選択します。




=== ポリシーの詳細設定を構成する

オプションで、ポリシーの詳細設定を行うことができます。これらの設定は、ローカルスナップショット、セカンダリストレージへのレプリケーション、オブジェクトストレージへのバックアップなど、すべてのバックアップアーキテクチャで利用できます。Kubernetesワークロードでは利用できません。

image:screen-br-policies-advanced.png["BlueXP backup and recoveryポリシーの詳細設定のスクリーンショット"]

.手順
. BlueXP backup and recoveryメニューから、[ポリシー] を選択します。
. [ポリシー] ページで、[新しいポリシーの作成] を選択します。
. *ポリシー > 詳細*設定セクションで、下矢印を選択し、オプションを選択します。
. 次の情報を入力します。
+
** *コピーのみのバックアップ*: 別のバックアップ アプリケーションを使用してリソースをバックアップできるコピーのみのバックアップ (Microsoft SQL Server バックアップの一種) を選択します。
** *可用性グループの設定*: 優先するバックアップレプリカを選択するか、特定のレプリカを指定します。この設定は、SQL Server 可用性グループがあり、バックアップに使用するレプリカを制御したい場合に便利です。
** *最大転送速度*：帯域幅使用量を制限しない場合は、「無制限」を選択します。転送速度を制限する場合は、「制限あり」を選択し、オブジェクトストレージへのバックアップアップロードに割り当てるネットワーク帯域幅を1～1,000 Mbpsの範囲で選択します。デフォルトでは、 ONTAPは作業環境のボリュームからオブジェクトストレージへのバックアップデータの転送に無制限の帯域幅を使用できます。バックアップトラフィックが通常のユーザーワークロードに影響を与えていることに気付いた場合は、転送中に使用されるネットワーク帯域幅を減らすことを検討してください。
** *バックアップの再試行*：障害または中断が発生した場合にジョブを再試行するには、「*障害発生時のジョブの再試行を有効にする*」を選択します。スナップショットおよびバックアップジョブの最大再試行回数と再試行間隔を入力します。再試行回数は10回未満である必要があります。この設定は、障害または中断が発生した場合にバックアップジョブを確実に再試行したい場合に便利です。
+

TIP: スナップショット頻度が 1 時間に設定されている場合、再試行回数と合わせた最大遅延は 45 分を超えてはなりません。





* *ランサムウェアスキャン*: 各バケットでランサムウェアスキャンを有効にするかどうかを選択します。有効にすると、ローカルスナップショットのスナップショットロック、セカンダリストレージのスナップショットロック、オブジェクトストレージのDataLockロックが有効になります。スキャンの頻度を日数で入力してください。


* *バックアップ検証*：バックアップ検証を有効にするかどうか、また、すぐに実行するか後で実行するかを選択します。この機能により、バックアップの有効性と復元の確実性が確保されます。バックアップの整合性を確保するために、このオプションを有効にすることをお勧めします。デフォルトでは、セカンダリストレージが設定されている場合、バックアップ検証はセカンダリストレージから実行されます。セカンダリストレージが設定されていない場合、バックアップ検証はプライマリストレージから実行されます。
+
image:screen-br-policies-advanced-more-backup-verification.png["BlueXP backup and recoveryポリシーのバックアップ検証設定のスクリーンショット"]

+
さらに、次のオプションを構成します。

+
** *毎日*、*毎週*、*毎月*、または*毎年*の検証：バックアップ検証で*後で*を選択した場合は、バックアップ検証の頻度を選択します。これにより、バックアップの整合性が定期的にチェックされ、正常に復元できるようになります。
** *バックアップラベル*: バックアップのラベルを入力します。このラベルはシステム内でバックアップを識別するために使用され、バックアップの追跡と管理に役立ちます。
** *データベース整合性チェック*：データベース整合性チェックを有効にするかどうかを選択します。このオプションは、バックアップを実行する前にデータベースが整合性のある状態であることを確認します。これは、データの整合性を確保するために非常に重要です。
** *ログバックアップの検証*：ログバックアップを検証するかどうかを選択します。検証サーバを選択します。ディスクツーディスクまたは3-2-1を選択した場合は、検証用の保存場所も選択してください。このオプションにより、ログバックアップが有効であり、正常に復元できることが保証されます。これは、データベースの整合性を維持するために重要です。


* *ネットワーク*: バックアップ操作に使用するネットワークインターフェースを選択します。複数のネットワークインターフェースがあり、どのインターフェースをバックアップに使用するかを制御したい場合に便利です。
+
** *IPspace*: バックアップ操作に使用するIPspaceを選択します。複数のIPspaceがあり、どのIPspaceをバックアップに使用するかを制御したい場合に便利です。
** *プライベートエンドポイント構成*：オブジェクトストレージにプライベートエンドポイントを使用している場合は、バックアップ操作に使用するプライベートエンドポイント構成を選択します。これは、プライベートネットワーク接続を介してバックアップが安全に転送されることを保証したい場合に便利です。


* *通知*: バックアップ操作に関するメール通知を有効にするかどうかを選択します。これは、バックアップ操作の開始、完了、または失敗時に通知を受け取りたい場合に便利です。




== ポリシーを編集します。

バックアップ アーキテクチャ、バックアップ頻度、保持ポリシー、およびポリシーのその他の設定を編集できます。

ポリシーを編集する際に保護レベルを追加することはできますが、保護レベルを削除することはできません。例えば、ポリシーがローカルスナップショットのみを保護している場合、セカンダリストレージへのレプリケーションやオブジェクトストレージへのバックアップを追加できます。ローカルスナップショットとレプリケーションがある場合は、オブジェクトストレージを追加できます。ただし、ローカルスナップショット、レプリケーション、オブジェクトストレージがある場合は、これらのレベルのいずれかを削除することはできません。

オブジェクト ストレージにバックアップするポリシーを編集している場合は、アーカイブを有効にすることができます。

SnapCenterからリソースをインポートした場合、 SnapCenterで使用されるポリシーとBlueXP backup and recoveryで使用されるポリシーにいくつかの違いが発生する可能性があります。を参照して link:reference-policy-differences-snapcenter.html["SnapCenterとBlueXP backup and recoveryのポリシーの違い"]

.必要なBlueXPロール
組織管理者またはフォルダーまたはプロジェクト管理者。  https://docs.netapp.com/us-en/bluexp-setup-admin/reference-iam-predefined-roles.html["すべてのサービスに対するBlueXPのアクセスロールについて学ぶ"^] 。

.手順
. BlueXPで、*保護* > *バックアップと復元*に進みます。
. *ポリシー*タブを選択します。
. 編集するポリシーを選択します。
. *アクション*を選択しますimage:icon-action.png["アクションアイコン"]アイコンをクリックし、[編集] を選択します。




== ポリシーを削除する

不要になったポリシーは削除できます。


TIP: ワークロードに関連付けられているポリシーは削除できません。

.手順
. BlueXPで、*保護* > *バックアップと復元*に進みます。
. *ポリシー*タブを選択します。
. 削除するポリシーを選択します。
. *アクション*を選択しますimage:icon-action.png["アクションアイコン"]アイコンをクリックし、[削除] を選択します。
. 確認ダイアログボックスの情報を確認し、「削除」を選択します。

