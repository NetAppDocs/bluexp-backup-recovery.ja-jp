---
sidebar: sidebar 
permalink: task-restore-backups-ontap.html 
keywords: restoring, restore, restore volumes, restore files, restore folders, cloud backup, file restore, single file restore, folder restore, volume restore, browse and restore, search and restore, ONTAP 
summary: バックアップは、特定の時点のデータをリストアできるように、クラウドアカウントのオブジェクトストアに格納されます。ONTAP ボリューム全体をバックアップファイルからリストアすることも、一部のファイルのみをリストアする必要がある場合は、バックアップファイルからフォルダまたは個々のファイルをリストアすることもできます。 
---
= バックアップファイルからの ONTAP データのリストア
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
バックアップは、特定の時点のデータをリストアできるように、クラウドアカウントのオブジェクトストアに格納されます。ONTAP ボリューム全体をバックアップファイルからリストアすることも、一部のファイルのみをリストアする必要がある場合は、バックアップファイルからフォルダまたは個々のファイルをリストアすることもできます。

元の作業環境、同じクラウドアカウントを使用している別の作業環境、またはオンプレミスの ONTAP システムに * ボリューム * を（新しいボリュームとして）リストアできます。

*フォルダ*を元の作業環境内のボリューム、同じクラウドアカウントを使用している別の作業環境内のボリューム、またはオンプレミスのONTAP システム上のボリュームにリストアできます。

* files * は、元の作業環境内のボリューム、同じクラウドアカウントを使用している別の作業環境内のボリューム、またはオンプレミスの ONTAP システム上のボリュームにリストアできます。

バックアップファイルから本番用システムにデータをリストアするには、有効なCloud Backupライセンスが必要です。



== リストアダッシュボード

リストアダッシュボードを使用して、ボリューム、フォルダ、およびファイルのリストア処理を実行できます。復元ダッシュボードにアクセスするには、BlueXPメニューの「*バックアップと復元*」をクリックし、次に「*復元*」タブをクリックします。をクリックすることもできます image:screenshot_gallery_options.gif["[ 詳細 ] ボタン"] >*サービス・パネルからバックアップ/リカバリ・サービスのリストア・ダッシュボード*を表示します


NOTE: 少なくとも 1 つの作業環境に対して Cloud Backup をアクティブ化しておく必要があります。また、初期バックアップファイルが存在する必要があります。

image:screenshot_restore_dashboard.png["[ リストアダッシュボード ] には '[ 参照とリストア ] または [ 検索とリストア ] 機能を使用するためのオプションが表示されます"]

ご覧のように、リストアダッシュボードでは、 * 参照と復元 * と * 検索と復元 * の 2 つの異なる方法でバックアップファイルからデータを復元できます。



== 参照と復元と検索と復元を比較します

一般的に、先週または月から特定のボリューム、フォルダ、またはファイルを復元する必要がある場合には、_Browse &Restore_(参照と復元)を使用してください。また、ファイルの名前と場所、およびファイルが正常な状態で最後に作成された日付を確認できます。_検索と復元_は、通常、ボリューム、フォルダ、またはファイルを復元する必要があるときに適していますが、正確な名前、保存されているボリューム、または最後に良好な状態になった日付は覚えていません。

この表は、 2 つの方法の比較を示しています。

[cols="50,50"]
|===
| 参照と復元 | 検索とリストア 


| フォルダ形式の構造を参照して、1つのバックアップファイル内のボリューム、フォルダ、またはファイルを検索します | すべてのバックアップファイル*のボリューム、フォルダ、ファイルを、ボリューム名またはボリューム名の一部または全部、サイズの範囲、および追加の検索フィルタで検索します 


| ボリュームとファイルのリストアは、Amazon S3、Azure Blob、Google Cloud、NetApp StorageGRID に格納されたバックアップファイルと連携します | ボリュームとファイルのリストアは、Amazon S3、Azure Blob、Google Cloud、NetApp StorageGRID に格納されたバックアップファイルと連携します 


| インターネットにアクセスできないサイトのStorageGRID からボリューム、フォルダ、およびファイルをリストアします | インターネットにアクセスできないサイトのStorageGRID からボリューム、フォルダ、およびファイルをリストアします 


| ファイルが削除または名前変更されており、元のファイル名がわからない場合は、はファイルリカバリを処理しません | 新しく作成 / 削除 / 名前変更されたディレクトリと新しく作成 / 削除 / 名前変更されたファイルを処理します 


| パブリッククラウドとプライベートクラウドの結果を参照できます | パブリッククラウドとローカル Snapshot コピーの結果を参照できます 


| クラウドプロバイダのリソースを追加する必要はありません | アカウントごとに、バケットとパブリッククラウドプロバイダのリソースを追加する必要があります 


| クラウドプロバイダのコストを追加する必要はありません | バックアップやボリュームをスキャンして検索結果を表示する際の、パブリッククラウドプロバイダのリソースに関連するコスト 
|===
いずれかのリストア方式を使用する前に、固有のリソース要件に対応するように環境を設定しておく必要があります。これらの要件については、以降のセクションで説明します。

使用するリストア処理のタイプに応じた要件とリストア手順を確認します。

* <<Restoring volumes using Browse & Restore,ブラウズおよびリストアを使用してボリュームをリストアします>>
* <<Restoring folders and files using Browse & Restore,ブラウズおよびリストアを使用して'フォルダとファイルをリストアします>>
* <<Restoring ONTAP data using Search & Restore,検索とリストアを使用して'ボリューム'フォルダ'およびファイルをリストアします>>




== 参照と復元を使用した ONTAP データの復元

ボリューム、フォルダ、またはファイルのリストアを開始する前に、リストアするボリュームの名前、作業環境の名前、ボリュームが配置されているSVM、およびリストア元のバックアップファイルのおおよその日付を確認しておく必要があります。

*注：リストア対象のデータを含むバックアップ・ファイルがアーカイブ・ストレージ（ONTAP 9.10.1以降）に格納されている場合は、リストア処理に長い時間がかかり、コストが発生します。また、ボリュームリストアの場合はONTAP 9.10.1以降、ファイルリストアの場合は9.11.1、Google ArchiveおよびStorageGRID の場合は9.12.1以降がデスティネーションクラスタで実行されている必要があります。

ifdef::aws[]

link:reference-aws-backup-tiers.html["AWS アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html["Azure アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html["Googleのアーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::gcp[]


NOTE: AzureアーカイブストレージからStorageGRID システムにデータをリストアする場合、優先度「高」はサポートされません。



=== サポートされている作業環境とオブジェクトストレージプロバイダの参照とリストア

ONTAP バックアップファイルから次の作業環境にボリューム、フォルダ、または個々のファイルをリストアできます。

[cols="50,50"]
|===
| バックアップファイルの場所 | デスティネーション作業環境ifdef：aws [] 


| Amazon S3 | AWSオンプレミスONTAP システムのCloud Volumes ONTAP 。endif：aws [] ifdef：azure[] 


| Azure Blob の略 | AzureオンプレミスONTAP システムのCloud Volumes ONTAP 。endif：azure[] ifdef：gCP[] 


| Google クラウドストレージ | GoogleオンプレミスONTAP システムのCloud Volumes ONTAP ：GCP[] 


| NetApp StorageGRID | オンプレミスの ONTAP システム 
|===
参照と復元の場合、コネクタは次の場所にインストールできます。

ifdef::aws[]

* Amazon S3の場合、ConnectorはAWSまたは自社運用のどちらにも導入できます


endif::aws[]

ifdef::azure[]

* Azure Blobの場合は、Azureまたは自社運用環境に導入できます


endif::azure[]

ifdef::gcp[]

* Google Cloud Storageの場合、ConnectorをGoogle Cloud Platform VPCに導入する必要があります


endif::gcp[]

* StorageGRID の場合は、インターネットアクセスを使用するかどうかに関係なく、コネクタを社内に導入する必要があります


「オンプレミス ONTAP システム」とは、 FAS 、 AFF 、 ONTAP Select の各システムを指します。


NOTE: バックアップファイルにDataLockとRansomwareが設定されている場合、フォルダやファイルをリストアすることはできません。この場合、バックアップファイルからボリューム全体をリストアし、必要なファイルにアクセスできます。



=== Browse & Restore を使用してボリュームをリストアする

バックアップファイルからボリュームをリストアすると、 Cloud Backup はバックアップのデータを使用して _new_volume を作成します。データは、元の作業環境のボリューム、またはソースの作業環境と同じクラウドアカウントにある別の作業環境にリストアできます。オンプレミスの ONTAP システムにボリュームをリストアすることもできます。

image:diagram_browse_restore_volume.png["ブラウズおよびリストアを使用してボリューム・リストアを実行するフローを示す図"]

この出力からわかるように、ボリュームリストアを実行するには、作業環境名、Storage VM、ボリューム名、バックアップファイルの日付を確認しておく必要があります。

次のビデオでは、ボリュームのリストア手順を簡単に紹介しています。

video::9Og5agUWyRk[youtube,width=848,height=480,end=164]
.手順
. BlueXPメニューから、*Protection > Backup and recovery*を選択します。
. [* Restore * （復元） ] タブをクリックすると、 [Restore Dashboard （復元ダッシュボード） ] が表示されます。
. [_Browse & Restore_] セクションで、 [* Restore Volume] をクリックします。
+
image:screenshot_restore_volume_selection.png["Restore Dashboard から Restore Volumes （ボリュームの復元）ボタンを選択するスクリーンショット。"]

. [ ソースの選択 ] ページで ' リストアするボリュームのバックアップ・ファイルに移動しますリストア元の日付 / 時刻スタンプを含む * Working Environment * 、 * Volume * 、および * Backup * ファイルを選択します。
+
image:screenshot_restore_select_volume_snapshot.png["リストアする作業環境、ボリューム、およびボリュームのバックアップファイルを選択するスクリーンショット。"]

. 「 * 次へ * 」をクリックします。
+
バックアップファイルに対してランサムウェア保護がアクティブになっている場合（バックアップポリシーでDataLockとRansomware Protectionを有効にしている場合）、データをリストアする前にバックアップファイルでランサムウェアスキャンを追加で実行するように求められます。バックアップファイルでランサムウェアをスキャンすることを推奨します。

. [ リストア先の選択 ] ページで、ボリュームをリストアする * 作業環境 * を選択します。
+
image:screenshot_restore_select_work_env_volume.png["リストアするボリュームのデスティネーション作業環境の選択のスクリーンショット。"]

. オンプレミスの ONTAP システムを選択し、オブジェクトストレージへのクラスタ接続をまだ設定していない場合は、追加情報を入力するように求められます。
+
ifdef::aws[]

+
** Amazon S3 からリストアする場合、デスティネーションボリュームを配置する ONTAP クラスタ内の IPspace を選択し、 ONTAP クラスタに S3 バケットへのアクセスを許可するために作成したユーザのアクセスキーとシークレットキーを入力します。 さらに、必要に応じて、セキュアなデータ転送を行うためのプライベート VPC エンドポイントを選択できます。




endif::aws[]

ifdef::azure[]

* Azure Blob からリストアする場合は、デスティネーションボリュームを配置する ONTAP クラスタ内の IPspace を選択し、オブジェクトストレージにアクセスする Azure サブスクリプションを選択します。また、 VNet とサブネットを選択して、データ転送を安全に行うプライベートエンドポイントを選択することもできます。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storage からリストアする場合は、オブジェクトストレージ、バックアップが格納されているリージョン、およびデスティネーションボリュームが配置される ONTAP クラスタ内の IPspace にアクセスするために、 Google Cloud Project とアクセスキーとシークレットキーを選択します。


endif::gcp[]

* StorageGRID StorageGRID からリストアする場合は、StorageGRID サーバのFQDNとONTAP とのHTTPS通信に使用するポートを入力し、オブジェクトストレージへのアクセスに必要なアクセスキーとシークレットキー、およびデスティネーションボリュームを配置するONTAP クラスタのIPspaceを選択します。
+
.. リストアしたボリュームに使用する名前を入力し、ボリュームを配置するStorage VMとアグリゲートを選択します。FlexGroup ボリュームをリストアするときは、複数のアグリゲートを選択できます。デフォルトでは、 * <source_volume_name> _ Restore * がボリューム名として使用されます。
+
image:screenshot_restore_new_vol_name.png["リストアする新しいボリュームの名前を入力するスクリーンショット。"]

+
また、（ ONTAP 9.10.1 以降で使用可能な）アーカイブストレージ階層にあるバックアップファイルからボリュームをリストアする場合は、リストア優先度を選択できます。

+
ifdef::aws[]





link:reference-aws-backup-tiers.html#restoring-data-from-archival-storage["AWS アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html#restoring-data-from-archival-storage["Azure アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html#restoring-data-from-archival-storage["Googleのアーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。Google Archiveストレージ階層内のバックアップファイルは、ほぼ即座にリストアされ、リストアの優先順位は不要です。

endif::gcp[]

. リストアの進行状況を確認できるように、 * リストア * をクリックするとリストアダッシュボードに戻ります。


.結果
Cloud Backup は、選択したバックアップに基づいて新しいボリュームを作成します。可能です link:task-manage-backups-ontap.html["この新しいボリュームのバックアップ設定を管理します"] 必要に応じて。

アーカイブストレージにあるバックアップファイルからボリュームをリストアする場合は、アーカイブ階層とリストアの優先順位によって数分から数時間かかることがあります。［*ジョブ監視*］タブをクリックすると、リストアの進行状況を確認できます。



=== Browse & Restoreを使用してフォルダとファイルを復元する

ONTAP のバックアップから数ファイルしかリストアしない場合は、ボリューム全体をリストアするのではなく、フォルダまたは個々のファイルをリストアするように選択できます。フォルダとファイルは元の作業環境の既存のボリューム、または同じクラウドアカウントを使用している別の作業環境にリストアできます。また、フォルダやファイルをオンプレミスのONTAP システム上のボリュームにリストアすることもできます。

複数のファイルを選択した場合は、選択したデスティネーションボリュームにすべてのファイルがリストアされます。したがって、ファイルを別のボリュームにリストアする場合は、リストアプロセスを複数回実行する必要があります。

ONTAP 9.13.0以降を使用している場合は、フォルダとそのフォルダ内のすべてのファイルおよびサブフォルダをリストアできます。9.13.0より前のバージョンのONTAP を使用している場合は、そのフォルダのファイルのみがリストアされます。サブフォルダまたはサブフォルダ内のファイルはリストアされません。

[NOTE]
====
* バックアップファイルにDataLockとRansomwareが設定されている場合、フォルダレベルのリストアは現在サポートされていません。この場合、バックアップファイルからボリューム全体をリストアし、必要なフォルダとファイルにアクセスできます。
* バックアップファイルがアーカイブストレージにある場合、フォルダレベルのリストアは現在サポートされていません。この場合、アーカイブされていない新しいバックアップファイルからフォルダをリストアするか、アーカイブされたバックアップからボリューム全体をリストアして、必要なフォルダとファイルにアクセスできます。


====


==== 前提条件

* FILE _ RESTORE処理を実行するには、ONTAP のバージョンが9.6以降である必要があります。
* リストア処理を実行するには、ONTAP のバージョンが9.11.1以降である必要があります。ifdef：aws []


endif::aws[]



==== フォルダおよびファイルのリストアプロセス

プロセスは次のようになります。

. ボリュームのバックアップからフォルダまたは1つ以上のファイルを復元する場合は、*復元*タブをクリックし、_参照&復元_の下の*ファイルまたはフォルダの復元*をクリックします。
. フォルダまたはファイルが存在するソースの作業環境、ボリューム、およびバックアップファイルを選択します。
. Cloud Backupに、選択したバックアップファイル内に存在するフォルダとファイルが表示されます。
. バックアップからリストアするフォルダまたはファイルを選択します。
. フォルダまたはファイル（作業環境、ボリューム、およびフォルダ）のリストア先を選択し、*リストア*をクリックします。
. ファイルがリストアされます。


image:diagram_browse_restore_file.png["ブラウズおよびリストアを使用してファイルのリストア操作を実行するフローを示す図"]

このように、フォルダまたはファイルのリストアを実行するには、作業環境名、ボリューム名、バックアップファイルの日付、およびフォルダ/ファイル名を知っている必要があります。



==== フォルダとファイルのリストア

ONTAP ボリュームのバックアップからボリュームにフォルダまたはファイルをリストアするには、次の手順を実行します。フォルダまたはファイルのリストアに使用するボリュームの名前とバックアップファイルの日付を確認しておく必要があります。この機能では、ライブブラウズを使用して、各バックアップファイル内のディレクトリとファイルのリストを表示できます。

次のビデオでは、 1 つのファイルをリストアする手順を簡単に紹介します。

video::9Og5agUWyRk[youtube,width=848,height=480,start=165]
.手順
. BlueXPメニューから、*Protection > Backup and recovery*を選択します。
. [* Restore * （復元） ] タブをクリックすると、 [Restore Dashboard （復元ダッシュボード） ] が表示されます。
. [参照と復元]セクションで、[*ファイルまたはフォルダの復元*]をクリックします。
+
image:screenshot_restore_files_selection.png["リストアダッシュボードから[ファイルまたはフォルダの復元]ボタンを選択するスクリーンショット。"]

. [ソースの選択]ページで'リストアするフォルダまたはファイルが格納されているボリュームのバックアップ・ファイルに移動しますファイルのリストア元の日付 / タイムスタンプを持つ * 作業環境 * 、 * ボリューム * 、および * バックアップ * を選択します。
+
image:screenshot_restore_select_source.png["リストアするボリュームおよびバックアップを選択するスクリーンショット。"]

. 「*次へ」をクリックすると、ボリュームバックアップのフォルダとファイルのリストが表示されます。
+
アーカイブストレージ階層（ONTAP 9.10.1以降で使用可能）にあるバックアップファイルからフォルダまたはファイルをリストアする場合は、リストア優先度を選択できます。

+
ifdef::aws[]



link:reference-aws-backup-tiers.html#restoring-data-from-archival-storage["AWS アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html#restoring-data-from-archival-storage["Azure アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html#restoring-data-from-archival-storage["Googleのアーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。Google Archiveストレージ階層内のバックアップファイルは、ほぼ即座にリストアされ、リストアの優先順位は不要です。

endif::gcp[]

+ランサムウェアからの保護がバックアップファイルに対して有効になっている場合（バックアップポリシーでDataLockとRansomware Protectionを有効にしている場合）、データをリストアする前にバックアップファイルでランサムウェアスキャンを実行するように求められます。バックアップファイルでランサムウェアをスキャンすることを推奨します。

[+]image:screenshot_restore_select_files.png["リストアするアイテムに移動できるようにする[アイテムの選択]ページのスクリーンショット。"]

. [アイテムの選択]ページで、復元するフォルダまたはファイルを選択し、[続行]をクリックします。アイテムの検索を支援するために、次の手順を実行します。
+
** フォルダまたはファイル名が表示されている場合は、その名前をクリックします。
** 検索アイコンをクリックしてフォルダまたはファイルの名前を入力すると、その項目に直接移動できます。
** を使用して、フォルダ内の下位レベルに移動できます image:button_subfolder.png[""] 特定のファイルを検索するには、行の末尾にあるボタンをクリックします。
+
ファイルを選択すると、ページの左側に追加され、選択済みのファイルが表示されます。必要に応じて、ファイル名の横にある * x * をクリックすると、このリストからファイルを削除できます。



. [リストア先の選択]ページで、項目をリストアする*作業環境*を選択します。
+
image:screenshot_restore_select_work_env.png["リストアする項目の移行先作業環境の選択に関するスクリーンショット。"]

+
オンプレミスクラスタを選択し、オブジェクトストレージへのクラスタ接続をまだ設定していない場合は、追加情報を入力するように求められます。

+
ifdef::aws[]

+
** Amazon S3 からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタの IPspace と、オブジェクトストレージへのアクセスに必要な AWS Access Key および Secret Key を入力します。クラスタへの接続にプライベートリンク設定を選択することもできます。




endif::aws[]

ifdef::azure[]

* Azure Blob からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタ内の IPspace を入力します。クラスタへの接続にプライベートエンドポイントの設定を選択することもできます。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storage からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタの IPspace と、オブジェクトストレージへのアクセスに必要なアクセスキーとシークレットキーを入力します。


endif::gcp[]

* StorageGRID StorageGRID からリストアする場合は、StorageGRID サーバのFQDNとONTAP とのHTTPS通信に使用するポートを入力し、オブジェクトストレージへのアクセスに必要なアクセスキーとシークレットキー、およびデスティネーションボリュームが配置されているONTAP クラスタのIPspaceを入力します。
+
.. 次に、フォルダーまたはファイルを復元する*ボリューム*と*フォルダー*を選択します。
+
image:screenshot_restore_select_dest.png["リストアするファイルのボリュームとフォルダを選択するスクリーンショット。"]

+
フォルダとファイルをリストアするときに、いくつかのオプションを選択できます。



* 上の図のように、 [ ターゲットフォルダの選択 ] を選択した場合は、次のようになります。
+
** 任意のフォルダを選択できます。
** フォルダにカーソルを合わせて、をクリックできます image:button_subfolder.png[""] 行の末尾にあるサブフォルダをドリルダウンし、フォルダを選択します。


* ソースフォルダ/ファイルがある場所と同じ宛先作業環境およびボリュームを選択した場合は、「ソースフォルダパスを保持」を選択して、ソース構造内に存在していたのと同じフォルダにフォルダまたはファイルを復元できます。同じフォルダとサブフォルダがすべて存在している必要があります。フォルダは作成されません。ファイルを元の場所にリストアする場合は、ソースファイルを上書きするか、新しいファイルを作成するかを選択できます。
+
.. リストアの進行状況を確認できるように、 * リストア * をクリックするとリストアダッシュボードに戻ります。また、*ジョブ監視*タブをクリックしてリストアの進捗状況を確認することもできます。






== 検索とリストアを使用した ONTAP データのリストア

検索とリストアを使用して、ONTAP バックアップファイルからボリューム、フォルダ、またはファイルをリストアできます。検索とリストアでは、クラウドストレージに保存されている特定のプロバイダのすべてのバックアップから特定のボリューム、フォルダ、またはファイルを検索し、リストアを実行できます。正確な作業環境名やボリューム名がわからなくても、検索ではすべてのボリュームのバックアップファイルが検索されます。

検索処理では、 ONTAP ボリュームに対応するすべてのローカル Snapshot コピーも検索されます。ローカル Snapshot コピーからデータをリストアする方が、バックアップファイルからリストアするよりも高速で低コストなので、 Snapshot からデータをリストアできます。Snapshotは新しいボリュームとしてリストアできます https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-manage-volumes.html#manage-volumes["キャンバスの[ボリュームの詳細]ページから選択します"^] （Cloud Backupではありません）。

バックアップファイルからボリュームをリストアすると、 Cloud Backup はバックアップのデータを使用して _new_volume を作成します。データは、元の作業環境のボリュームとしてリストアすることも、ソースの作業環境と同じクラウドアカウントにある別の作業環境にリストアすることもできます。オンプレミスの ONTAP システムにボリュームをリストアすることもできます。

フォルダやファイルは、元のボリュームの場所、同じ作業環境内の別のボリューム、または同じクラウドアカウントを使用している別の作業環境にリストアできます。また、フォルダやファイルをオンプレミスのONTAP システム上のボリュームにリストアすることもできます。

ONTAP 9.13.0以降を使用している場合は、フォルダとそのフォルダ内のすべてのファイルおよびサブフォルダをリストアできます。9.13.0より前のバージョンのONTAP を使用している場合は、そのフォルダのファイルのみがリストアされます。サブフォルダまたはサブフォルダ内のファイルはリストアされません。

リストアするボリュームのバックアップファイルがアーカイブストレージ（ONTAP 9.10.1以降で使用可能）にある場合、リストア処理にはより長い時間がかかり、追加コストが発生します。また、ボリュームリストアの場合はONTAP 9.10.1以降、ファイルリストアの場合は9.11.1、Google ArchiveおよびStorageGRID の場合は9.12.1以降がデスティネーションクラスタで実行されている必要があります。

ifdef::aws[]

link:reference-aws-backup-tiers.html["AWS アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html["Azure アーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html["Googleのアーカイブストレージからのリストアの詳細については、こちらをご覧ください"]。

endif::gcp[]

[NOTE]
====
* バックアップファイルにDataLockとRansomwareが設定されている場合、フォルダレベルのリストアは現在サポートされていません。この場合、バックアップファイルからボリューム全体をリストアし、必要なフォルダとファイルにアクセスできます。
* バックアップファイルがアーカイブストレージにある場合、フォルダレベルのリストアは現在サポートされていません。この場合、アーカイブされていない新しいバックアップファイルからフォルダをリストアするか、アーカイブされたバックアップからボリューム全体をリストアして、必要なフォルダとファイルにアクセスできます。
* AzureアーカイブストレージからStorageGRID システムにデータをリストアする場合、リストア優先度を[高]にすることはできません。


====
開始する前に、リストアするボリュームやファイルの名前や場所を把握しておく必要があります。

次のビデオでは、 1 つのファイルをリストアする手順を簡単に紹介します。

video::RZktLe32hhQ[youtube,width=848,height=480]


=== サポートされている作業環境とオブジェクトストレージプロバイダの検索とリストア

ONTAP バックアップファイルから次の作業環境にボリューム、フォルダ、または個々のファイルをリストアできます。

[cols="35,45"]
|===
| バックアップファイルの場所 | デスティネーション作業環境ifdef：aws [] 


| Amazon S3 | AWSオンプレミスONTAP システムのCloud Volumes ONTAP 。endif：aws [] ifdef：azure[] 


| Azure Blob の略 | AzureオンプレミスONTAP システムのCloud Volumes ONTAP 。endif：azure[] ifdef：gCP[] 


| Google クラウドストレージ | GoogleオンプレミスONTAP システムのCloud Volumes ONTAP ：GCP[] 


| NetApp StorageGRID | オンプレミスの ONTAP システム 
|===
検索と復元の場合、コネクタは次の場所にインストールできます。

ifdef::aws[]

* Amazon S3の場合、ConnectorはAWSまたは自社運用のどちらにも導入できます


endif::aws[]

ifdef::azure[]

* Azure Blobの場合は、Azureまたは自社運用環境に導入できます


endif::azure[]

ifdef::gcp[]

* Google Cloud Storageの場合、ConnectorをGoogle Cloud Platform VPCに導入する必要があります


endif::gcp[]

* StorageGRID の場合は、インターネットアクセスを使用するかどうかに関係なく、コネクタを社内に導入する必要があります


「オンプレミス ONTAP システム」とは、 FAS 、 AFF 、 ONTAP Select の各システムを指します。



=== 前提条件

* クラスタの要件：
+
** ONTAP のバージョンは 9.8 以降である必要があります。
** ボリュームが配置されている Storage VM （ SVM ）に設定済みのデータ LIF が必要です。
** ボリュームでNFSが有効になっている必要があります（NFSとSMB / CIFSの両方のボリュームがサポートされています）。
** SVM で SnapDiff RPC サーバをアクティブ化する必要があります。作業環境でインデックス作成を有効にすると'BlueXPによって自動的に実行されます（SnapDiffは、2つのSnapshotコピー間のファイルやディレクトリの差異を迅速に識別するテクノロジです）。




ifdef::aws[]

* AWS の要件：
+
** BlueXPに権限を付与するユーザロールに、Amazon Athena、AWS Glue、およびAWS S3の特定の権限を追加する必要があります。 link:task-backup-onprem-to-aws.html#set-up-s3-permissions["すべての権限が正しく設定されていることを確認します"]。
+
以前に設定したコネクタでCloud Backupをすでに使用している場合は、Athena権限とGlue権限をBlueXPユーザーロールに追加する必要があります。これらは新しい機能で、検索とリストアに必要です。





endif::aws[]

ifdef::azure[]

* Azureの要件：
+
** Azure Synapse Analytics Resource Provider（"Microsoft.Synapse"）をサブスクリプションに登録する必要があります。 https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#register-resource-provider["このリソースプロバイダをサブスクリプションに登録する方法については、を参照してください"^]。リソースプロバイダを登録するには、Subscription * Owner *または* Contributor *である必要があります。
** 特定のAzure Synapse WorkspaceおよびData Lakeストレージアカウントの権限を、BlueXPに権限を付与するユーザーロールに追加する必要があります。 link:task-backup-onprem-to-azure.html#verify-or-add-permissions-to-the-connector["すべての権限が正しく設定されていることを確認します"]。
+
以前に設定したコネクタでCloud Backupをすでに使用している場合は、Azure Synapse WorkspaceとData Lake Storage Accountの権限をBlueXPユーザーロールに追加する必要があります。これらは新しい機能で、検索とリストアに必要です。

** インターネットへのHTTP通信には、*プロキシサーバーなしでコネクターを設定する必要があります。コネクタにHTTPプロキシサーバを設定している場合は、検索と置換機能を使用できません。




endif::azure[]

ifdef::gcp[]

* Google Cloudの要件：
+
** 特定のGoogle BigQuery権限は、BlueXPに権限を付与するユーザーロールに追加する必要があります。 link:task-backup-onprem-to-gcp.html#verify-or-add-permissions-to-the-connector["すべての権限が正しく設定されていることを確認します"]。
+
以前に設定したコネクタでCloud Backupをすでに使用している場合は、今すぐBigQuery権限をBlueXPユーザーロールに追加する必要があります。これらは新しい機能で、検索とリストアに必要です。





endif::gcp[]

* StorageGRID の要件：
+
構成に応じて、検索とリストアの2つの方法が実装されています。

+
** アカウントにクラウドプロバイダの資格情報がない場合は、インデックスカタログの情報がコネクタに保存されます。
** ダークサイトでコネクタを使用している場合は、インデックスカタログ情報がコネクタに保存されます（コネクタバージョン3.9.25以上が必要です）。
** ある場合 https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-accounts-aws.html["AWS クレデンシャル"^] または https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-accounts-azure.html["Azure のクレデンシャル"^] アカウントでは、クラウドに展開されたコネクタと同様に、インデックスカタログがクラウドプロバイダに格納されます。（両方のクレデンシャルがある場合は、デフォルトでAWSが選択されます）。
+
オンプレミスコネクタを使用している場合でも、コネクタ権限とクラウドプロバイダリソースの両方についてクラウドプロバイダの要件を満たしている必要があります。この実装を使用する場合は、前述のAWSとAzureの要件を参照してください。







=== 検索とリストアのプロセス

プロセスは次のようになります。

. 検索とリストアを使用する前に、ボリュームデータのリストア元となる各ソース作業環境でインデックスの作成を有効にする必要があります。これにより、 Indexed Catalog は、すべてのボリュームのバックアップファイルを追跡できます。
. ボリュームバックアップからボリュームまたはファイルを復元する場合は、 _ 検索と復元 _ で * 検索と復元 * をクリックします。
. ボリューム、フォルダ、またはファイルの検索条件を、ボリューム名またはボリューム名の一部または全体、サイズ範囲、作成日範囲、その他の検索フィルタで入力し、*検索*をクリックします。
+
検索結果ページには、検索条件に一致するファイルまたはボリュームを含むすべての場所が表示されます。

. ボリュームまたはファイルの復元に使用する場所の * すべてのバックアップの表示 * をクリックし、実際に使用するバックアップファイルの * 復元 * をクリックします。
. ボリューム、フォルダ、またはファイルをリストアする場所を選択し、*リストア*をクリックします。
. ボリューム、フォルダ、またはファイルがリストアされます。


image:diagram_search_restore_vol_file.png["Search  Restoreを使用してボリューム'フォルダ'またはファイルのリストア操作を実行するフローを示す図"]

ご覧のように、Cloud Backupでは部分的な名前を知っているだけで、検索条件に一致するすべてのバックアップファイルが検索されます。



=== 各作業環境のインデックスカタログを有効にする

検索とリストアを使用する前に、ボリュームまたはファイルのリストア元となる各ソース作業環境でインデックス作成を有効にする必要があります。これにより、インデックスカタログですべてのボリュームとすべてのバックアップファイルを追跡できるため、検索をすばやく効率的に実行できます。

この機能を有効にすると、ボリュームに対してCloud BackupがSVMでSnapDiff v3を有効にし、次の処理を実行します。

ifdef::aws[]

* AWSに格納されたバックアップについては、新しいS3バケットとがプロビジョニングされます https://aws.amazon.com/athena/faqs/["Amazon Athena インタラクティブクエリーサービス"^] および https://aws.amazon.com/glue/faqs/["AWS グルーサーバレスデータ統合サービス"^]。


endif::aws[]

ifdef::azure[]

* Azureに保存されているバックアップの場合、Azure Synapseワークスペースとデータレイクファイルシステムをワークスペースデータを格納するコンテナとしてプロビジョニングします。


endif::azure[]

ifdef::gcp[]

* Google Cloudに保存されているバックアップの場合、新しいバケットとがプロビジョニングされます https://cloud.google.com/bigquery["Google Cloud BigQueryサービス"^] アカウント/プロジェクトレベルでプロビジョニングされます。


endif::gcp[]

* StorageGRID に格納されたバックアップ用に、コネクタまたはクラウドプロバイダの環境にスペースがプロビジョニングされます。


作業環境でインデックス作成がすでに有効になっている場合は ' 次のセクションに進んでデータをリストアしてください

作業環境でインデックス作成を有効にするには：

* 作業環境にインデックスが作成されていない場合は、リストアダッシュボードの _Search&Restore_ で * 作業環境でインデックス作成を有効にする * をクリックし、作業環境で * インデックス作成を有効にする * をクリックします。
* 少なくとも 1 つの作業環境にインデックスが作成されている場合は、リストアダッシュボードの _Search & Restore_ で、 * インデックス設定 * をクリックし、作業環境で * インデックス作成を有効にする * をクリックします。


すべてのサービスがプロビジョニングされ、インデックスカタログがアクティブ化されると、作業環境は「アクティブ」と表示されます。

image:screenshot_restore_enable_indexing.png["インデックスカタログをアクティブ化した作業環境を示すスクリーンショット。"]

作業環境内のボリュームのサイズとクラウド内のバックアップファイルの数によっては、最初のインデックス作成プロセスに最大 1 時間かかることがあります。その後は、 1 時間ごとに差分変更を反映して透過的に更新され、最新の状態が維持されます。



=== 検索とリストアを使用したボリューム、フォルダ、およびファイルのリストア

お先にどうぞ <<各作業環境のインデックスカタログを有効にする,作業環境のインデックス作成を有効にしました>>では、検索とリストアを使用して、ボリューム、フォルダ、およびファイルをリストアできます。これにより、幅広いフィルタを使用して、すべてのバックアップファイルからリストアするファイルまたはボリュームを検索できます。

.手順
. BlueXPメニューから、*Protection > Backup and recovery*を選択します。
. [* Restore * （復元） ] タブをクリックすると、 [Restore Dashboard （復元ダッシュボード） ] が表示されます。
. [ 検索と復元 ] セクションで、 [ * 検索と復元 * ] をクリックします。
+
image:screenshot_restore_start_search_restore.png["リストアダッシュボードから [ 検索と復元 ] ボタンを選択するスクリーンショット。"]

. [リストアする検索（Search to Restore）]ページから、次の
+
.. _検索バー_で、ボリューム名、フォルダ名、またはファイル名の全体または一部を入力します。
.. リソースのタイプとして、* Volumes *、* Files *、* Folders *、* All *を選択します。
.. [_Filter by_]領域で、フィルタ条件を選択します。たとえば、データが存在する作業環境とファイルの種類（.jpegファイルなど）を選択できます。


. [*検索（* Search）]をクリックすると、検索結果（Search Results）領域に、検索に一致するファイル、フォルダ、またはボリュームを含むすべてのリソースが表示されます。
+
image:screenshot_restore_step1_search_restore.png["検索条件と検索結果を示すスクリーンショットが [ 検索とリストア ] ページに表示されます"]

. リストアするデータを含むリソースの*すべてのバックアップを表示*をクリックすると、一致するボリューム、フォルダ、またはファイルを含むすべてのバックアップファイルが表示されます。
+
image:screenshot_restore_step2_search_restore.png["検索条件に一致するすべてのバックアップを表示する方法を示すスクリーンショット。"]

. クラウドから項目を復元するために使用するバックアップファイルに対して、*復元*をクリックします。
+
検索結果からは、検索結果にファイルが含まれているローカルボリュームの Snapshot コピーも特定されます。この時点では、スナップショットに対して * リストア * ボタンは機能しませんが、バックアップファイルではなく Snapshot コピーからデータをリストアする場合は、ボリュームの名前と場所を書き留め、キャンバスのボリュームの詳細ページを開きます。 および * Restore from Snapshot copy * オプションを使用します。

. ボリューム、フォルダ、またはファイルのリストア先を選択し、*リストア*をクリックします。
+
** ボリュームについては、元の作業環境を選択するか、別の作業環境を選択できます。FlexGroup ボリュームをリストアするときは、複数のアグリゲートを選択できます。
** フォルダの場合は、元の場所にリストアすることも、作業環境、ボリューム、フォルダなどの別の場所を選択することもできます。
** ファイルの場合は、元の場所にリストアするか、作業環境、ボリューム、フォルダなどの別の場所を選択できます。元の場所を選択する場合は、ソースファイルを上書きするか、新しいファイルを作成するかを選択できます。
+
オンプレミスの ONTAP システムを選択し、オブジェクトストレージへのクラスタ接続をまだ設定していない場合は、追加情報を入力するように求められます。

+
ifdef::aws[]

+
*** Amazon S3 からリストアする場合、デスティネーションボリュームを配置する ONTAP クラスタ内の IPspace を選択し、 ONTAP クラスタに S3 バケットへのアクセスを許可するために作成したユーザのアクセスキーとシークレットキーを入力します。 さらに、必要に応じて、セキュアなデータ転送を行うためのプライベート VPC エンドポイントを選択できます。 link:task-backup-onprem-to-aws.html#cluster-networking-requirements["これらの要件の詳細を参照してください"]。






endif::aws[]

ifdef::azure[]

* Azure Blobからリストアする場合は、デスティネーションボリュームを配置するONTAP クラスタ内のIPspaceを選択し、VNetとサブネットを選択してデータ転送を保護するプライベートエンドポイントを必要に応じて選択します。 link:task-backup-onprem-to-azure.html#requirements["これらの要件の詳細を参照してください"]。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storageからリストアする場合は、デスティネーションボリュームを配置するONTAP クラスタ内のIPspaceと、オブジェクトストレージにアクセスするためのアクセスキーとシークレットキーを選択します。 link:task-backup-onprem-to-gcp.html#requirements["これらの要件の詳細を参照してください"]。


endif::gcp[]

* StorageGRID StorageGRID からリストアする場合は、StorageGRID サーバのFQDNとONTAP とのHTTPS通信に使用するポートを入力し、オブジェクトストレージへのアクセスに必要なアクセスキーとシークレットキー、およびデスティネーションボリュームが配置されているONTAP クラスタのIPspaceを入力します。 link:task-backup-onprem-private-cloud.html#requirements["これらの要件の詳細を参照してください"]。


.結果
ボリューム、フォルダ、またはファイルがリストアされ、リストアダッシュボードに戻り、リストア処理の進捗状況を確認できます。また、*ジョブ監視*タブをクリックしてリストアの進捗状況を確認することもできます。

リストアしたボリュームに対しては、を実行できます link:task-manage-backups-ontap.html["この新しいボリュームのバックアップ設定を管理します"] 必要に応じて。
